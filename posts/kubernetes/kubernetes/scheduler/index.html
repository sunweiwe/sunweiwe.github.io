<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
kubernetes scheduler"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:title" content="kubernetes scheduler"><meta property="og:description" content="
kubernetes scheduler"><meta property="og:type" content="article"><meta property="og:url" content="https://sunweiwe.github.io/posts/kubernetes/kubernetes/scheduler/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-02-24T15:46:14+08:00"><meta property="article:modified_time" content="2023-07-20T22:53:08+08:00"><title>kubernetes scheduler | sunweiwe/blog</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png><link rel=stylesheet href=/book.min.4f0117e74e5337280f18eb9641eae520cb4b25adcf5dd64fafad4664145a5957.css integrity="sha256-TwEX505TNygPGOuWQerlIMtLJa3PXdZPr61GZBRaWVc=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.1b2bf308793e524c7bd66e1d113796241ab6ddb1a1506b85efbaca90f34d339f.js integrity="sha256-GyvzCHk+Ukx71m4dETeWJBq23bGhUGuF77rKkPNNM58=" crossorigin=anonymous></script>
<script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>sunweiwe/blog</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=/posts/>Blog</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>kubernetes scheduler</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li><a href=#调度器配置>调度器配置</a><ul><li><a href=#配置文件>配置文件</a></li></ul></li><li><a href=#调度策略>调度策略</a><ul><li><a href=#调度流程>调度流程</a></li></ul></li></ul></li></ul></nav></aside></header><article class="markdown book-post"><h1><a href=/posts/kubernetes/kubernetes/scheduler/>kubernetes scheduler</a></h1><h5>February 24, 2023</h5><div><a href=/tags/kubernetes/>kubernetes</a>,
<a href=/tags/scheduler/>scheduler</a></div><p>kubernetes scheduler</p><h2 id=调度器配置>调度器配置
<a class=anchor href=#%e8%b0%83%e5%ba%a6%e5%99%a8%e9%85%8d%e7%bd%ae>#</a></h2><p>你可以通过编写配置文件，并将其路径传给 kube-scheduler 的命令行参数，定制 kube-scheduler 的行为。</p><p>调度模板（Profile）允许你配置 kube-scheduler 中的不同调度阶段。每个阶段都暴露于某个扩展点中。插件通过实现一个或多个扩展点来提供调度行为。</p><p>你可以通过运行 kube-scheduler &ndash;config <filename>来设置调度模板， 使用 KubeSchedulerConfiguration（v1beta3 或 v1）结构体。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>kubescheduler.config.k8s.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>KubeSchedulerConfiguration</span>
</span></span><span style=display:flex><span><span style=color:#f92672>clientConnection</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>kubeconfig</span>: <span style=color:#ae81ff>/etc/srv/kubernetes/kube-scheduler/kubeconfig</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>说明：</span>
</span></span></code></pre></div><h3 id=配置文件>配置文件
<a class=anchor href=#%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6>#</a></h3><p>调度行为发生在一系列阶段中，这些阶段是通过以下扩展点公开的：</p><h4 id=扩展点>扩展点
<a class=anchor href=#%e6%89%a9%e5%b1%95%e7%82%b9>#</a></h4><ul><li>queueSort：这些插件对调度队列中的悬决的 Pod 排序。 一次只能启用一个队列排序插件。</li><li>preFilter：这些插件用于在过滤之前预处理或检查 Pod 或集群的信息。 它们可以将 Pod 标记为不可调度。</li><li>filter：这些插件相当于调度策略中的断言（Predicates），用于过滤不能运行 Pod 的节点。 过滤器的调用顺序是可配置的。 如果没有一个节点通过所有过滤器的筛选，Pod 将会被标记为不可调度。</li><li>postFilter：当无法为 Pod 找到可用节点时，按照这些插件的配置顺序调用他们。 如果任何 postFilter 插件将 Pod 标记为可调度，则不会调用其余插件。</li><li>preScore：这是一个信息扩展点，可用于预打分工作。</li><li>score：这些插件给通过筛选阶段的节点打分。调度器会选择得分最高的节点。</li><li>reserve：这是一个信息扩展点，当资源已经预留给 Pod 时，会通知插件。 这些插件还实现了 Unreserve 接口，在 Reserve 期间或之后出现故障时调用。</li><li>permit：这些插件可以阻止或延迟 Pod 绑定。</li><li>preBind：这些插件在 Pod 绑定节点之前执行。</li><li>bind：这个插件将 Pod 与节点绑定。bind 插件是按顺序调用的，只要有一个插件完成了绑定，其余插件都会跳过。bind 插件至少需要一个。</li><li>postBind：这是一个信息扩展点，在 Pod 绑定了节点之后调用。</li><li>multiPoint：这是一个仅配置字段，允许同时为所有适用的扩展点启用或禁用插件</li></ul><h2 id=调度策略>调度策略
<a class=anchor href=#%e8%b0%83%e5%ba%a6%e7%ad%96%e7%95%a5>#</a></h2><p>调度器通过 Kubernetes 的监测（Watch）机制来发现集群中新创建且尚未被调度到节点上的 Pod。 调度器会将所发现的每一个未调度的 Pod 调度到一个合适的节点上来运行。 调度器会依据下文的调度原则来做出调度选择。</p><h3 id=调度流程>调度流程
<a class=anchor href=#%e8%b0%83%e5%ba%a6%e6%b5%81%e7%a8%8b>#</a></h3><ul><li>过滤</li><li>打分</li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li><a href=#调度器配置>调度器配置</a><ul><li><a href=#配置文件>配置文件</a></li></ul></li><li><a href=#调度策略>调度策略</a><ul><li><a href=#调度流程>调度流程</a></li></ul></li></ul></li></ul></nav></div></aside></main></body></html>