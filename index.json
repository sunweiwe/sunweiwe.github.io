[{"content":"Hi there ğŸ‘‹ # ğŸ”­ Iâ€™m currently working on Java and Typescript. ğŸŒ± Iâ€™m currently learning C++ \u0026amp; Java. ğŸ’¬ Ask me about: Anything! ğŸ“« How to reach me: sun_weiwe@163.com ","date":null,"permalink":"/","section":"","summary":"Hi there ğŸ‘‹ # ğŸ”­ Iâ€™m currently working on Java and Typescript. ğŸŒ± Iâ€™m currently learning C++ \u0026amp; Java. ğŸ’¬ Ask me about: Anything! ğŸ“« How to reach me: sun_weiwe@163.com ","title":""},{"content":"","date":null,"permalink":"/tags/database/","section":"Tags","summary":"","title":"Database"},{"content":"æ•°æ®åº“ #CRUD #Insert # INSERT INTO user VALUES (10,\u0026#39;root\u0026#39;,\u0026#39;root\u0026#39;,\u0026#34;name@163.com\u0026#34;),(11,\u0026#39;user\u0026#39;,\u0026#39;user\u0026#39;,\u0026#34;name@163.com\u0026#34;); INSERT INTO user(username, password, email) VALUES (\u0026#39;admin\u0026#39;, \u0026#39;admin\u0026#39;, \u0026#39;xxxx@163.com\u0026#39;); Update #UPDATE user SET username=\u0026#39;root\u0026#39;,password=\u0026#39;root\u0026#39; WHERE username = \u0026#39;root\u0026#39;; Delte #DELETE FROM user WHERE username = \u0026#39;root\u0026#39;; // æ¸…ç©ºè¡¨æ•°æ® TRUNCATE TABLE user; Select #SELECT name FROM user; SELECT id,name FROM user; SELECT * FROM user; SELECT DISINCT id FROM user; SELECT * FROM user LIMIT 5; SELECT * FROM user LIMIT 0,5; SELECT * FROM user LIMIT 2,3; æ’åº # // desc é™åº SELECT * FROM user ORDER BY create_time ASC, age DESC åˆ†ç»„ #SELECT name, COUNT(address) AS addr_count FROM user GROUP BY name; SELECT name, COUNT(address) AS addr_count FROM user GROUP BY name ORDER BY name DESC; having # å¯¹æ±‡æ€»çš„ group by ç»“æœè¿›è¡Œè¿‡æ»¤ ä¸€èˆ¬å’Œ group by è¿ç”¨ SELECT name, COUNT(*) AS count FROM user WHERE email IS NOT NULL GROUP BY name HAVING COUNT(*) \u0026gt;= 1; å­æŸ¥è¯¢ #where #select column_name [, column_name ] from table1 [, table2 ] where column_name operator (select column_name [, column_name ] from table1 [, table2 ] [where]) from #select column_name [, column_name ] from (select column_name [, column_name ] from table1 [, table2 ] [where]) as temp_table_name where condition IN,BETWEEN #SELECT * FROM user WHERE id IN (\u0026#39;1\u0026#39;, \u0026#39;2\u0026#39;); SELECT * FROM user WHERE age BETWEEN 3 AND 5; AND,OR,NOT # SELECT id, name, address FROM user WHERE name = \u0026#39;name\u0026#39; AND age \u0026gt;= 18; SELECT id, name, address FROM user WHERE name = \u0026#39;name\u0026#39; OR age \u0026gt;= 18; SELECT * FROM user WHERE age NOT BETWEEN 8 AND 18; è¿æ¥ # è¿æ¥è¡¨çš„æœ¬è´¨å°±æ˜¯å°†ä¸åŒè¡¨çš„è®°å½•åˆå¹¶èµ·æ¥ï¼Œå½¢æˆä¸€å¼ æ–°è¡¨ã€‚å½“ç„¶ï¼Œè¿™å¼ æ–°è¡¨åªæ˜¯ä¸´æ—¶çš„ï¼Œå®ƒä»…å­˜åœ¨äºæœ¬æ¬¡æŸ¥è¯¢æœŸé—´ã€‚\n# join....on select c.cust_name, o.order_num from Customers c inner join Orders o on c.cust_id = o.cust_id order by c.cust_name; # å¦‚æœä¸¤å¼ è¡¨çš„å…³è”å­—æ®µåç›¸åŒï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨USINGå­å¥ï¼šjoin....using() select c.cust_name, o.order_num from Customers c inner join Orders o using(cust_id) order by c.cust_name; è¿æ¥ç±»å‹ è¯´æ˜ inner join ï¼ˆé»˜è®¤é“¾æ¥æ–¹å¼ï¼‰åªæœ‰ä¸¤ä¸ªæ ‡éƒ½å­˜åœ¨æ»¡è¶³æ¡ä»¶çš„è®°å½•æ‰ä¼šè¿”å›è¡Œã€‚ left join/left outer join è¿”å›å·¦è¡¨çš„æ‰€æœ‰è¡Œï¼Œå³ä½¿å³è¡¨ä¸­æ²¡æœ‰æ»¡è¶³æ¡ä»¶çš„è¡Œä¹Ÿæ˜¯å¦‚æ­¤ã€‚ right join/right outer join è¿”å›å³è¡¨ä¸­çš„æ‰€æœ‰è¡Œï¼Œå³ä½¿å·¦è¡¨æ²¡æœ‰æ»¡è¶³æ¡ä»¶çš„è¡Œä¹Ÿæ˜¯å¦‚æ­¤ã€‚ full join/full outer join è¿”å›å…¶ä¸­ä¸€ä¸ªè¡¨å­˜åœ¨æ»¡è¶³æ¡ä»¶çš„è®°å½•ã€‚ self join å°†ä¸€ä¸ªè¡¨è¿æ¥åˆ°è‡ªèº«ï¼Œå°±åƒè¯¥è¡¨æ˜¯ä¸¤ä¸ªè¡¨ä¸€æ ·ã€‚ä¸ºäº†åŒºåˆ†ä¸¤ä¸ªè¡¨ï¼Œåœ¨ SQL è¯­å¥ä¸­éœ€è¦è‡³å°‘é‡å‘½åä¸€ä¸ªè¡¨ã€‚ cross join äº¤å‰è¿æ¥ï¼Œä»ä¸¤ä¸ªæˆ–è€…å¤šä¸ªè¿æ¥è¡¨ä¸­è¿”å›è®°å½•é›†çš„ç¬›å¡å°”ç§¯ã€‚ ç»„åˆ # UNION è¿ç®—ç¬¦å°†ä¸¤ä¸ªæˆ–æ›´å¤šæŸ¥è¯¢çš„ç»“æœç»„åˆèµ·æ¥ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªç»“æœé›†ï¼Œå…¶ä¸­åŒ…å«æ¥è‡ª UNION ä¸­å‚ä¸æŸ¥è¯¢çš„æå–è¡Œã€‚\nUNION åŸºæœ¬è§„åˆ™ï¼š\næ‰€æœ‰æŸ¥è¯¢çš„åˆ—æ•°å’Œåˆ—é¡ºåºå¿…é¡»ç›¸åŒã€‚ æ¯ä¸ªæŸ¥è¯¢ä¸­æ¶‰åŠè¡¨çš„åˆ—çš„æ•°æ®ç±»å‹å¿…é¡»ç›¸åŒæˆ–å…¼å®¹ã€‚ é€šå¸¸è¿”å›çš„åˆ—åå–è‡ªç¬¬ä¸€ä¸ªæŸ¥è¯¢ SELECT column_name(s) FROM table1 UNION ALL SELECT column_name(s) FROM table2; å‡½æ•° #æ•°æ®åº“å®šä¹‰ #æ•°æ®åº“ #CREATE DATABASE test; DROP DATABASE test; USE test; æ•°æ®è¡¨ #CREATE TABLE user ( id int(10) unsigned NOT NULL COMMENT \u0026#39;Id\u0026#39;, username varchar(64) NOT NULL DEFAULT \u0026#39;default\u0026#39; COMMENT \u0026#39;ç”¨æˆ·å\u0026#39;, password varchar(64) NOT NULL DEFAULT \u0026#39;default\u0026#39; COMMENT \u0026#39;å¯†ç \u0026#39;, email varchar(64) NOT NULL DEFAULT \u0026#39;default\u0026#39; COMMENT \u0026#39;é‚®ç®±\u0026#39; ) COMMENT=\u0026#39;ç”¨æˆ·è¡¨\u0026#39;; CREATE TABLE vip_user AS SELECT * FROM user; DROP TABLE user; ALTER TABLE user ADD age int(3); ALTER TABLE user DROP COLUMN age; ALTER TABLE `user` MODIFY COLUMN age tinyint; ALTER TABLE user ADD PRIMARY KEY (id); ALTER TABLE user DROP PRIMARY KEY; è§†å›¾ #å®šä¹‰ # è§†å›¾æ˜¯åŸºäº SQL è¯­å¥çš„ç»“æœé›†çš„å¯è§†åŒ–çš„è¡¨ã€‚ è§†å›¾æ˜¯è™šæ‹Ÿçš„è¡¨ï¼Œæœ¬èº«ä¸åŒ…å«æ•°æ®ï¼Œä¹Ÿå°±ä¸èƒ½å¯¹å…¶è¿›è¡Œç´¢å¼•æ“ä½œã€‚å¯¹è§†å›¾çš„æ“ä½œå’Œå¯¹æ™®é€šè¡¨çš„æ“ä½œä¸€æ ·ã€‚ ä½œç”¨ # ç®€åŒ–å¤æ‚çš„ SQL æ“ä½œï¼Œæ¯”å¦‚å¤æ‚çš„è”ç»“ï¼› åªä½¿ç”¨å®é™…è¡¨çš„ä¸€éƒ¨åˆ†æ•°æ®ï¼› é€šè¿‡åªç»™ç”¨æˆ·è®¿é—®è§†å›¾çš„æƒé™ï¼Œä¿è¯æ•°æ®çš„å®‰å…¨æ€§ï¼› æ›´æ”¹æ•°æ®æ ¼å¼å’Œè¡¨ç¤ºã€‚ CREATE VIEW top_10_user_view AS SELECT id,name FROM user WHERE id \u0026lt; 10; DROP VIEW top_10_user_view; ç´¢å¼• # ç´¢å¼•æ˜¯ä¸€ç§ç”¨äºå¿«é€ŸæŸ¥è¯¢å’Œæ£€ç´¢æ•°æ®çš„æ•°æ®ç»“æ„ï¼Œå…¶æœ¬è´¨å¯ä»¥çœ‹æˆæ˜¯ä¸€ç§æ’åºå¥½çš„æ•°æ®ç»“æ„ã€‚\nCREATE INDEX user_index ON user (id); ALTER table user ADD INDEX user_index(id) CREATE UNIQUE INDEX user_index ON user (id); ALTER TABLE user DROP INDEX user_index; çº¦æŸ # NOT NULL UNIQUE PRIMARY KEY FOREIGN KEY CHECK DEFAULT CREATE TABLE Users ( Id INT(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT \u0026#39;è‡ªå¢Id\u0026#39;, Username VARCHAR(64) NOT NULL UNIQUE DEFAULT \u0026#39;default\u0026#39; COMMENT \u0026#39;ç”¨æˆ·å\u0026#39;, Password VARCHAR(64) NOT NULL DEFAULT \u0026#39;default\u0026#39; COMMENT \u0026#39;å¯†ç \u0026#39;, Email VARCHAR(64) NOT NULL DEFAULT \u0026#39;default\u0026#39; COMMENT \u0026#39;é‚®ç®±åœ°å€\u0026#39;, Enabled TINYINT(4) DEFAULT NULL COMMENT \u0026#39;æ˜¯å¦æœ‰æ•ˆ\u0026#39;, PRIMARY KEY (Id) ) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COMMENT=\u0026#39;ç”¨æˆ·è¡¨\u0026#39;; äº‹åŠ¡å¤„ç† # START TRANSACTION - æŒ‡ä»¤ç”¨äºæ ‡è®°äº‹åŠ¡çš„èµ·å§‹ç‚¹ã€‚ SAVEPOINT - æŒ‡ä»¤ç”¨äºåˆ›å»ºä¿ç•™ç‚¹ã€‚ ROLLBACK TO - æŒ‡ä»¤ç”¨äºå›æ»šåˆ°æŒ‡å®šçš„ä¿ç•™ç‚¹ï¼›å¦‚æœæ²¡æœ‰è®¾ç½®ä¿ç•™ç‚¹ï¼Œåˆ™å›é€€åˆ° START TRANSACTION è¯­å¥å¤„ã€‚ COMMIT - æäº¤äº‹åŠ¡ã€‚ -- å¼€å§‹äº‹åŠ¡ START TRANSACTION; -- æ’å…¥æ“ä½œ A INSERT INTO `user` VALUES (1, \u0026#39;root1\u0026#39;, \u0026#39;root1\u0026#39;, \u0026#39;xxxx@163.com\u0026#39;); -- åˆ›å»ºä¿ç•™ç‚¹ updateA SAVEPOINT updateA; -- æ’å…¥æ“ä½œ B INSERT INTO `user` VALUES (2, \u0026#39;root2\u0026#39;, \u0026#39;root2\u0026#39;, \u0026#39;xxxx@163.com\u0026#39;); -- å›æ»šåˆ°ä¿ç•™ç‚¹ updateA ROLLBACK TO updateA; -- æäº¤äº‹åŠ¡ï¼Œåªæœ‰æ“ä½œ A ç”Ÿæ•ˆ COMMIT; å­˜å‚¨è¿‡ç¨‹ # ä»£ç å°è£…ï¼Œä¿è¯äº†ä¸€å®šçš„å®‰å…¨æ€§ï¼› ä»£ç å¤ç”¨ï¼› ç”±äºæ˜¯é¢„å…ˆç¼–è¯‘ï¼Œå› æ­¤å…·æœ‰å¾ˆé«˜çš„æ€§èƒ½ã€‚ DROP PROCEDURE IF EXISTS `proc_adder`; DELIMITER ;; CREATE DEFINER=`root`@`localhost` PROCEDURE `proc_adder`(IN a int, IN b int, OUT sum int) BEGIN DECLARE c int; if a is null then set a = 0; end if; if b is null then set b = 0; end if; set sum = a + b; END ;; DELIMITER ; ","date":"22.11.2023","permalink":"/posts/database/database/syntax/","section":"Posts","summary":"æ•°æ®åº“çš„åŸºæœ¬è¯­æ³•ä½¿ç”¨","title":"database syntax"},{"content":"","date":null,"permalink":"/posts/","section":"Posts","summary":"","title":"Posts"},{"content":"","date":null,"permalink":"/tags/","section":"Tags","summary":"","title":"Tags"},{"content":"","date":null,"permalink":"/tags/java/","section":"Tags","summary":"","title":"Java"},{"content":"å¹¶å‘ #çº¿ç¨‹ #çº¿ç¨‹çŠ¶æ€ # New Runnable Blocked Waiting Timed waiting Terminated synchronized # å¯é‡å…¥ public class Bank{ private Lock lock = new ReentrantLock(); private Condition sufficientFunds; public Bank(){ sufficientFunds = lock.newCondition(); } public void transfer(int from, int amount){ lock.lock();// a ReentrantLock object try{ // critical section while(accounts[form] \u0026lt; amount){ // æŒ‚èµ·çº¿ç¨‹ï¼Œé‡Šæ”¾é” sufficientFunds.await(); } sufficientFunds.signalAll(); }finally{ lock.unlock(); } } // OR public synchronized void syncTransfer(int from,int amount) throw InterruptedException { while(accounts[from] \u0026lt; amount) wait(); accounts[from] -= amount; accounts[to] += amount; notifyAll(); } } volatile å’Œ final # ä¿è¯æ•°æ®çš„å¯è§æ€§ï¼Œä½†ä¸ä¿è¯æ•°æ®çš„åŸå­æ€§ã€‚ é˜²æ­¢JVMçš„æŒ‡ä»¤é‡æ’ã€‚æ’å…¥ç‰¹å®šçš„ å†…å­˜å±éšœçš„æ–¹å¼ç¦æ­¢æŒ‡ä»¤é‡æ’åºã€‚ public native void loadFence(); public native void storeFence(); public native void fullFence(); åŸå­æ€§ # AtomicIntegerFieldupdater åŸå­æ›´æ–°æ•´å‹å­—æ®µçš„æ›´æ–°å™¨ AtmoicLongFieldUpdater åŸå­æ›´æ–°é•¿æ•´å‹å­—æ®µçš„æ›´æ–°å™¨ AtmoicReferenceFieldUpdater åŸå­æ›´æ–°å¼•ç”¨ç±»å‹é‡Œçš„å­—æ®µ public static AtmoicLong nextNumber = new AtomicLong(); long id = nextNumber.incrementAndGet(); é” #private ReentrantReadWriteLock rw = new ReentrantReadWriterLock(); private Lock readLock = rw.readLock(); private Lock writeLock = rw.writeLock(); public doube getTotalBalance() { readLock.lock(); try{ }finally{ readLock.unlock(); } } public void transfer(){ writeLock.lock(); try{ }finally{ writeLock.unlock(); } } çº¿ç¨‹å®‰å…¨çš„é›†åˆ # ConcurrentHashMap ConcurrentSkipListMap ConcurrentSkipListSet ConcurrentLinkedQueue æ‰§è¡Œå™¨ # newCachedThreadPool newFiexdThreadPool newSingleThreadExcutor newScheduledThreadPool newSingleThreadScheduledExcutor ","date":"16.11.2023","permalink":"/posts/java/java/thread/","section":"Posts","summary":"Java thread ç›¸å…³çŸ¥è¯†ç‚¹","title":"thread"},{"content":"å­—ç¬¦ä¸² # ç¼“å­˜åŠŸèƒ½ è®¡ç®—å™¨ ç»Ÿè®¡å¤šå•ä½çš„æ•°é‡ å…±äº«ç”¨æˆ·session SET key value [EX seconds|PX milliseconds|EXAT timestamp|PXAT milliseconds-timestamp|KEEPTTL] [NX|XX] [GET] List(åˆ—è¡¨) # listç±»å‹æ˜¯ç”¨æ¥å­˜å‚¨å¤šä¸ªæœ‰åºçš„å­—ç¬¦ä¸²çš„ï¼Œåˆ—è¡¨å½“ä¸­çš„æ¯ä¸€ä¸ªå­—ç¬¦çœ‹åšä¸€ä¸ªå…ƒç´  ä¸€ä¸ªåˆ—è¡¨å½“ä¸­å¯ä»¥å­˜å‚¨æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªå…ƒç´ ï¼Œredisçš„listæ”¯æŒå­˜å‚¨2^32æ¬¡æ–¹-1ä¸ªå…ƒç´ ã€‚ rediså¯ä»¥ä»åˆ—è¡¨çš„ä¸¤ç«¯è¿›è¡Œæ’å…¥ï¼ˆpubshï¼‰å’Œå¼¹å‡ºï¼ˆpopï¼‰å…ƒç´ ï¼Œæ”¯æŒè¯»å–æŒ‡å®šèŒƒå›´çš„å…ƒç´ é›†ï¼Œæˆ–è€…è¯»å–æŒ‡å®šä¸‹æ ‡çš„å…ƒç´ ç­‰æ“ä½œã€‚redisåˆ—è¡¨æ˜¯ä¸€ç§æ¯”è¾ƒçµæ´»çš„é“¾è¡¨æ•°æ®ç»“æ„ï¼Œå®ƒå¯ä»¥å……å½“é˜Ÿåˆ—æˆ–è€…æ ˆçš„è§’è‰²ã€‚ redisåˆ—è¡¨æ˜¯é“¾è¡¨å‹çš„æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥å®ƒçš„å…ƒç´ æ˜¯æœ‰åºçš„ï¼Œè€Œä¸”åˆ—è¡¨å†…çš„å…ƒç´ æ˜¯å¯ä»¥é‡å¤çš„ã€‚æ„å‘³ç€å®ƒå¯ä»¥æ ¹æ®é“¾è¡¨çš„ä¸‹æ ‡è·å–æŒ‡å®šçš„å…ƒç´ å’ŒæŸä¸ªèŒƒå›´å†…çš„å…ƒç´ é›†ã€‚ ä½¿ç”¨åœºæ™¯ # æ¶ˆæ¯é˜Ÿåˆ—ï¼šreidsçš„é“¾è¡¨ç»“æ„ï¼Œå¯ä»¥è½»æ¾å®ç°é˜»å¡é˜Ÿåˆ—ï¼Œå¯ä»¥ä½¿ç”¨å·¦è¿›å³å‡ºçš„å‘½ä»¤ç»„æˆæ¥å®Œæˆé˜Ÿåˆ—çš„è®¾è®¡ã€‚æ¯”å¦‚ï¼šæ•°æ®çš„ç”Ÿäº§è€…å¯ä»¥é€šè¿‡Lpushå‘½ä»¤ä»å·¦è¾¹æ’å…¥æ•°æ®ï¼Œå¤šä¸ªæ•°æ®æ¶ˆè´¹è€…ï¼Œå¯ä»¥ä½¿ç”¨BRpopå‘½ä»¤é˜»å¡çš„â€œæŠ¢â€åˆ—è¡¨å°¾éƒ¨çš„æ•°æ®ã€‚\næ–‡ç« åˆ—è¡¨æˆ–è€…æ•°æ®åˆ†é¡µå±•ç¤ºçš„åº”ç”¨ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„åšå®¢ç½‘ç«™çš„æ–‡ç« åˆ—è¡¨ï¼Œå½“ç”¨æˆ·é‡è¶Šæ¥è¶Šå¤šæ—¶ï¼Œè€Œä¸”æ¯ä¸€ä¸ªç”¨æˆ·éƒ½æœ‰è‡ªå·±çš„æ–‡ç« åˆ—è¡¨ï¼Œè€Œä¸”å½“æ–‡ç« å¤šæ—¶ï¼Œéƒ½éœ€è¦åˆ†é¡µå±•ç¤ºï¼Œè¿™æ—¶å¯ä»¥è€ƒè™‘ä½¿ç”¨redisçš„åˆ—è¡¨ï¼Œåˆ—è¡¨ä¸ä½†æœ‰åºåŒæ—¶è¿˜æ”¯æŒæŒ‰ç…§èŒƒå›´å†…è·å–å…ƒç´ ï¼Œå¯ä»¥å®Œç¾è§£å†³åˆ†é¡µæŸ¥è¯¢åŠŸèƒ½ã€‚å¤§å¤§æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚\nSet(é›†åˆ) # redisé›†åˆï¼ˆsetï¼‰ç±»å‹å’Œliståˆ—è¡¨ç±»å‹ç±»ä¼¼ï¼Œéƒ½å¯ä»¥ç”¨æ¥å­˜å‚¨å¤šä¸ªå­—ç¬¦ä¸²å…ƒç´ çš„é›†åˆã€‚ ä½†æ˜¯å’Œlistä¸åŒçš„æ˜¯seté›†åˆå½“ä¸­ä¸å…è®¸é‡å¤çš„å…ƒç´ ã€‚è€Œä¸”seté›†åˆå½“ä¸­å…ƒç´ æ˜¯æ²¡æœ‰é¡ºåºçš„ï¼Œä¸å­˜åœ¨å…ƒç´ ä¸‹æ ‡ã€‚ redisçš„setç±»å‹æ˜¯ä½¿ç”¨å“ˆå¸Œè¡¨æ„é€ çš„ï¼Œå› æ­¤å¤æ‚åº¦æ˜¯O(1)ï¼Œå®ƒæ”¯æŒé›†åˆå†…çš„å¢åˆ æ”¹æŸ¥ï¼Œ å¹¶ä¸”æ”¯æŒå¤šä¸ªé›†åˆé—´çš„äº¤é›†ã€å¹¶é›†ã€å·®é›†æ“ä½œã€‚å¯ä»¥åˆ©ç”¨è¿™äº›é›†åˆæ“ä½œï¼Œè§£å†³ç¨‹åºå¼€å‘è¿‡ç¨‹å½“ä¸­å¾ˆå¤šæ•°æ®é›†åˆé—´çš„é—®é¢˜ã€‚ ä½¿ç”¨åœºæ™¯ # æ ‡ç­¾ï¼šæ¯”å¦‚æˆ‘ä»¬åšå®¢ç½‘ç«™å¸¸å¸¸ä½¿ç”¨åˆ°çš„å…´è¶£æ ‡ç­¾ï¼ŒæŠŠä¸€ä¸ªä¸ªæœ‰ç€ç›¸åŒçˆ±å¥½ï¼Œå…³æ³¨ç±»ä¼¼å†…å®¹çš„ç”¨æˆ·åˆ©ç”¨ä¸€ä¸ªæ ‡ç­¾æŠŠä»–ä»¬è¿›è¡Œå½’å¹¶ã€‚\nå…±åŒå¥½å‹åŠŸèƒ½ã€‚\nç»Ÿè®¡ç½‘ç«™çš„ç‹¬ç«‹IP\nsorted setï¼ˆæœ‰åºé›†åˆï¼‰ # redisæœ‰åºé›†åˆä¹Ÿæ˜¯é›†åˆç±»å‹çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥å®ƒä¿ç•™äº†é›†åˆä¸­å…ƒç´ ä¸èƒ½é‡å¤çš„ç‰¹æ€§ï¼Œä½†æ˜¯ä¸åŒçš„æ˜¯ï¼Œæœ‰åºé›†åˆç»™æ¯ä¸ªå…ƒç´ å¤šè®¾ç½®äº†ä¸€ä¸ªåˆ†æ•°ã€‚\nåº”ç”¨åœºæ™¯ # æ’è¡Œæ¦œï¼šæœ‰åºé›†åˆç»å…¸ä½¿ç”¨åœºæ™¯ã€‚ä¾‹å¦‚è§†é¢‘ç½‘ç«™éœ€è¦å¯¹ç”¨æˆ·ä¸Šä¼ çš„è§†é¢‘åšæ’è¡Œæ¦œï¼Œæ¦œå•ç»´æŠ¤å¯èƒ½æ˜¯å¤šæ–¹é¢ï¼šæŒ‰ç…§æ—¶é—´ã€æŒ‰ç…§æ’­æ”¾é‡ã€æŒ‰ç…§è·å¾—çš„èµæ•°ç­‰ã€‚ ç”¨Sorted Setsæ¥åšå¸¦æƒé‡çš„é˜Ÿåˆ—ï¼Œæ¯”å¦‚æ™®é€šæ¶ˆæ¯çš„scoreä¸º1ï¼Œé‡è¦æ¶ˆæ¯çš„scoreä¸º2ï¼Œç„¶åå·¥ä½œçº¿ç¨‹å¯ä»¥é€‰æ‹©æŒ‰scoreçš„å€’åºæ¥è·å–å·¥ä½œä»»åŠ¡ã€‚è®©é‡è¦çš„ä»»åŠ¡ä¼˜å…ˆæ‰§è¡Œã€‚ 5 hashï¼ˆå“ˆå¸Œï¼‰ # å­˜å‚¨ç”¨æˆ·ç›¸å…³ä¿¡æ¯ã€‚ä¼˜åŒ–ç”¨æˆ·ä¿¡æ¯çš„è·å–ï¼Œä¸éœ€è¦é‡å¤ä»æ•°æ®åº“å½“ä¸­è¯»å–ï¼Œæé«˜ç³»ç»Ÿæ€§èƒ½ã€‚ Bitmapsï¼ˆä½å­˜å‚¨ï¼‰ #æŒä¹…åŒ– # å¿«ç…§ï¼ˆRDBæ–‡ä»¶ï¼‰RDBæŒä¹…åŒ–æ–¹å¼ä¼šåœ¨ä¸€ä¸ªç‰¹å®šçš„é—´éš”ä¿å­˜é‚£ä¸ªæ—¶é—´ç‚¹çš„æ•°æ®å¿«ç…§ã€‚\nè¿½åŠ å¼æ–‡ä»¶ï¼ˆAOFæ–‡ä»¶ï¼‰AOFæŒä¹…åŒ–æ–¹å¼åˆ™ä¼šè®°å½•æ¯ä¸€ä¸ªæœåŠ¡å™¨æ”¶åˆ°çš„å†™æ“ä½œã€‚åœ¨æœåŠ¡å¯åŠ¨æ—¶ï¼Œè¿™äº›è®°å½•çš„æ“ä½œä¼šé€æ¡æ‰§è¡Œä»è€Œé‡å»ºå‡ºåŸæ¥çš„æ•°æ®ã€‚å†™æ“ä½œå‘½ä»¤è®°å½•çš„æ ¼å¼è·ŸRedisåè®®ä¸€è‡´ï¼Œä»¥è¿½åŠ çš„æ–¹å¼è¿›è¡Œä¿å­˜ã€‚\n","date":"15.11.2023","permalink":"/posts/redis/redis/basic/","section":"Posts","summary":"redisåŸºæœ¬æ•°æ®ç±»å‹å’Œç”¨æ³•","title":"basic"},{"content":"","date":null,"permalink":"/tags/redis/","section":"Tags","summary":"","title":"Redis"},{"content":"ä»è¿­ä»£åˆ°æµçš„æ“ä½œ # var contents = new String(Files.readAllBytes( Paths.get(\u0026#34;alice.txt\u0026#34;)),StandardCharsets.UTF_8); List\u0026lt;String\u0026gt; words = List.of(contents.split(\u0026#34;\\\\PL+\u0026#34;)); int count = 0; for (String w : words){ if (w.length()\u0026gt;12) count++; } long count = words.parallelStream().filter(w -\u0026gt; w.length() \u0026gt;12 ).count(); ","date":"15.11.2023","permalink":"/posts/java/java/stream/","section":"Posts","summary":"Javaæµçš„æ¦‚å¿µå’Œç”¨æ³•","title":"stream"},{"content":"","date":null,"permalink":"/tags/stream/","section":"Tags","summary":"","title":"Stream"},{"content":"é¢å‘å¯¹è±¡ # å°è£… ç»§æ‰¿ å¤šæ€ ç±» # æ„é€ å™¨å’Œç±»åŒå æ¯ä¸ªç±»å¯ä»¥æœ‰ä¸€ä¸ªä»¥ä¸Šæ„é€ å™¨ æ„é€ å™¨å¯ä»¥æœ‰0,1æˆ–å¤šä¸ªå‚æ•° æ„é€ å™¨æ²¡æœ‰è¿”å›å€¼ æ„é€ å™¨æ€»ä¼´éšç€newæ“ä½œç¬¦ä¸€èµ·è°ƒç”¨ ç»§æ‰¿ # ä½¿ç”¨ extends\nè¦†ç›–æ–¹æ³• # override\né˜»æ­¢ç»§æ‰¿: fianlç±»å’Œæ–¹æ³• #æ³›å‹æ•°ç»„åˆ—è¡¨(å®¹å™¨) #å£°æ˜ #ArrayList\u0026lt;String\u0026gt; s = new ArrayList\u0026lt;String\u0026gt;(); var s = new ArrayList\u0026lt;String\u0026gt;(); ArrayList\u0026lt;String\u0026gt; s = new ArrayList\u0026lt;\u0026gt;(); å¯¹è±¡åŒ…è£…å™¨ä¸è‡ªåŠ¨è£…ç®± # Integer Long Float Double Short Byte Character Boolean æ¥å£ #æ¦‚å¿µ # æ¥å£ä¸æ˜¯ç±», è€Œæ˜¯å¯¹å¸Œæœ›ç¬¦åˆè¿™ä¸ªæ¥å£çš„ç±»çš„ä¸€ç»„éœ€æ±‚\nç±»å®ç°æ¥å£ # å°†ç±»å£°æ˜ä¸ºå®ç°ç»™å®šçš„æ¥å£ å¯¹æ¥å£ä¸­çš„æ‰€æœ‰æ–¹æ³•æä¾›å®šä¹‰ class Employee implements Comparable\u0026lt;Employee\u0026gt; { public int compareTo(Object otherObject){ Employee other = (Emplyoee) otherObject; return Double.compare(salary,other.salary); } } ","date":"15.11.2023","permalink":"/posts/java/java/class/","section":"Posts","summary":"ç±»çš„ä½¿ç”¨","title":"class"},{"content":"æ•°æ®ç±»å‹ # å…«ç§åŸºæœ¬ç±»å‹ï¼Œå…¶ä¸­å››ç§æ•´å‹ï¼Œä¸¤ç§æµ®ç‚¹ç±»å‹ï¼Œ1ç§å­—ç¬¦ä¸²ç±»å‹å’Œä¸€ç§çœŸå€¼ç±»å‹\næ•´å‹ # ç±»å‹ å­˜å‚¨éœ€æ±‚ å–å€¼èŒƒå›´ int 4å­—èŠ‚ -2147483648 ~ 2147483647 short 2å­—èŠ‚ -32768 ~ 32767 long 8å­—èŠ‚ -9223372036854775808 ~ 9223372036854775807 byte 1å­—èŠ‚ -128 ~ 127 æµ®ç‚¹å‹ # ç±»å‹ å­˜å‚¨éœ€æ±‚ å–å€¼èŒƒå›´ float 4å­—èŠ‚ å¤§çº¦ +- 3.40282347E+38F (æœ‰æ•ˆä½æ•°ä¸º6~7ä½) double 8å­—èŠ‚ å¤§çº¦ +- 1.79769313486231570E+308 (æœ‰æ•ˆä½æ•°ä¸º15ä½) å¸¸é‡ # ä½¿ç”¨ final æŒ‡ç¤ºå¸¸é‡ï¼Œä½¿ç”¨ static final å£°æ˜ç±»å¸¸é‡ã€‚\næšä¸¾ç±»å‹ #enum Size { SMALL, MEDIUM, LARGE, EXTRA_LARGE }; ä½è¿ç®—ç¬¦ # \u0026amp; and | or ^ xor ~ not \u0026laquo; å³ç§» å·¦ç§»\nå­—ç¬¦ä¸² # ä½¿ç”¨ equals æ–¹æ³•æ£€æµ‹æ˜¯å¦ç›¸ç­‰ã€‚ == åªèƒ½ç¡®å®šæ˜¯å¦å­˜æ”¾åœ¨åŒä¸€ä¸ªä½ç½®ã€‚\nStringBuilder builder = new StringBuilder(); builder.append(ch); String completedString = builder.toString(); è¾“å…¥ä¸è¾“å‡º #è¯»å–è¾“å…¥ #Scanner in = new Scanner(System.in); System.out.print(\u0026#34;What\u0026#39;s up?\u0026#34;); String name = in.nextLine(); String firstName = in.next(); // è¯»å–å¯†ç  Console cons = System.consloe(); String username = cons.readLine(\u0026#34;User name: \u0026#34;); char[] password = cons.readPassword(\u0026#34;Password: \u0026#34;); æ ¼å¼åŒ–è¾“å‡º # System.out.print, System.out.printf\nè½¬æ¢ç¬¦ ç±»å‹ å®ä¾‹ d åè¿›åˆ¶æ•´æ•° 159 x åå…­è¿›åˆ¶æ•´æ•° 9f o å…«è¿›åˆ¶æ•´æ•° 237 f å®šç‚¹æµ®ç‚¹æ•° 15.9 e æŒ‡ç‚¹æµ®ç‚¹æ•° 15.9e+01 g é€šç”¨æµ®ç‚¹æ•°ï¼ˆeå’Œfä¸­è¾ƒçŸ­çš„ä¸€ä¸ªï¼‰ 15.9e+01 a åå…­è¿›åˆ¶æµ®ç‚¹æ•° 0x1.fccdp3 s å­—ç¬¦ä¸² Hello c å­—ç¬¦ H b å¸ƒå°” true h æ•£åˆ—ç  42628b2 txæˆ–Tx æ—¥æœŸæ—¶é—´(Tå¼ºåˆ¶å¤§å†™) å·²ç»è¿‡æ—¶ï¼Œä½¿ç”¨ java.time n ä¸å¹³å°æœ‰å…³çš„è¡Œåˆ†éš”ç¬¦ - æ–‡ä»¶è¾“å…¥äºè¾“å‡º # // è¯»æ–‡ä»¶ Scanner in = new Scanner(Path.of(\u0026#34;file.txt\u0026#34;),StandardCharsets.UTF_8); // å†™æ–‡ä»¶ PrintWriter out = new PrintWriter(\u0026#34;file.txt\u0026#34;,StandardCharsets.UTF_8); å¤§æ•° # BigInter \u0026amp; BigDecimal\nBiginteger value = BigInteger.valueOf(100); BigInteger r = new BigInteger(\u0026#34;222323421312432423423423432423432423423434\u0026#34;); constants # BigInteger.ZERO BigInteger.ONE BigInteger.TEN BigInteger.TWO å¤§æ•°çš„ç®—æœ¯è¿ç®—éœ€è¦ä½¿ç”¨ add å’Œ multiply æ–¹æ³•\nlotteryOdds = lotteryOdds * (n - i + 1)/i; lotteryOdds = lotteryOdds.multiply(BigInterger.valueOf(n - i + 1)).divide(BigInteger.valueOf(i)); æ•°ç»„ #å£°æ˜æ•°ç»„ #int[] numbers; int a = new int[100]; int[] s = { 2,3,4}; for(int v: s){ System.out.println(v); } æ•°ç»„æ‹·è´ #// æŒ‡å‘åŒä¸€ä¸ªåœ°å€ int[] before = {1,2}; int[] after = before; // æ‹·è´åˆ°æ–°çš„æ•°ç»„ä¸­ int[] differ = Arrays.copyOf(before,before.length); æ•°ç»„æ’åº # sort æ–¹æ³•ä½¿ç”¨äº†ä¼˜åŒ–çš„å¿«é€Ÿæ’åºç®—æ³•\nint[] a = new int[1000]; Arrays.sort(a); ","date":"15.11.2023","permalink":"/posts/java/java/syntax/","section":"Posts","summary":"Javaçš„åŸºæœ¬æ•°æ®ç±»å‹","title":"syntax"},{"content":"","date":null,"permalink":"/tags/syntax/","section":"Tags","summary":"","title":"SyntaxÂ·"},{"content":"ä½¿ç”¨åœºæ™¯ # æ¯”å¦‚ä¸‹é¢æ˜¯é€šè¿‡ JDK å®ç°åŠ¨æ€ä»£ç†çš„ç¤ºä¾‹ä»£ç ï¼Œå…¶ä¸­å°±ä½¿ç”¨äº†åå°„ç±» Method æ¥è°ƒç”¨æŒ‡å®šçš„æ–¹æ³•ã€‚\nè¿è¡Œæ—¶åˆ†æç±»çš„èƒ½åŠ› åœ¨è¿è¡Œæ—¶æ£€æŸ¥å¯¹è±¡ å®ç°æ³›å‹æ•°ç»„æ“ä½œä»£ç  åˆ©ç”¨methodå¯¹è±¡ public class DebugInvocationHandler implements InvocationHandler { /** * ä»£ç†ç±»ä¸­çš„çœŸå®å¯¹è±¡ */ private final Object target; public DebugInvocationHandler(Object target) { this.target = target; } public Object invoke(Object proxy, Method method, Object[] args) throws InvocationTargetException, IllegalAccessException { System.out.println(\u0026#34;before method \u0026#34; + method.getName()); Object result = method.invoke(target, args); System.out.println(\u0026#34;after method \u0026#34; + method.getName()); return result; } } åŸºæœ¬æ“ä½œ #package cn.app public class TargetObject { private String value; public TargetObject() { value = \u0026#34;App\u0026#34; } public void publicMethod(String s) { System.out.println(\u0026#34;This is \u0026#34;+ s ); } private void privateMethod(){ System.out.println(\u0026#34;value is \u0026#34;+ value); } } package cn.app; import java.lang.reflect.Field; import java.lang.reflect.InvocationTargetException; import java.lang.reflect.Method; public class Main { public static void main(String[] args) throws ClassNotFoundException, NoSuchMethodException, IllegalAccessException, InstantiationException, InvocationTargetException, NoSuchFieldException { /** * è·å– TartgetObject ç±»çš„Class å¯¹è±¡å¹¶ä¸”åˆ›å»º TartgetObject ç±»å®ä¾‹ */ Class\u0026lt;?\u0026gt; tartgetClass = class.forName(\u0026#34;cn.app.TartgetObject\u0026#34;); TargetObject tartgetObject = (TargetObject) targetClass.newInstance(); Method[] methods = targetClass.getDeclaredMethods(); for (Method method: methods){ System.out.println(method.getName()); } Method publicMethod = targetClass.getDeclaredMethod(\u0026#34;publicMethod\u0026#34;,String.class); publicMethod.invoke(tartgetObject,\u0026#34;sunweiwe\u0026#34;); Field field = tartgetClass.getDeclaredField(\u0026#34;value\u0026#34;); field.setAccessible(true); field.set(tartgetObject,\u0026#34;sunweiwe\u0026#34;); Method privateMethod = tartgetClass.getDeclaredMethod(\u0026#34;privateMethod\u0026#34;); privateMethod.setAccessible(true); privateMethod.invoke(tartgetObject); } } ","date":"15.11.2023","permalink":"/posts/java/java/reflect/","section":"Posts","summary":"Java åå°„åŸºæœ¬ä½¿ç”¨","title":"reflect"},{"content":"","date":null,"permalink":"/tags/reflect/","section":"Tags","summary":"","title":"Reflect"},{"content":"æ³¨è§£ #SpringBootApplication #@SpringBootApplication public class SpringSecurityJwtGuideApplication { public static void main(java.lang.String[] args) { SpringApplication.run(SpringSecurityJwtGuideApplication.class, args); } } // ç›¸å½“äº @ComponentScan @Configuration @EnableAutoConfiguration package org.springframework.boot.autoconfigure; @Target(ElementType.TYPE) @Retention(RetentionPolicy.RUNTIME) @Documented @Inherited @SpringBootConfiguration @EnableAutoConfiguration @ComponentScan(excludeFilters = { @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class), @Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) }) public @interface SpringBootApplication { ...... } package org.springframework.boot; @Target(ElementType.TYPE) @Retention(RetentionPolicy.RUNTIME) @Documented @Configuration public @interface SpringBootConfiguration { } @EnableAutoConfigurationï¼šå¯ç”¨ SpringBoot çš„è‡ªåŠ¨é…ç½®æœºåˆ¶ @ComponentScanï¼šæ‰«æè¢«@Component (@Repository,@Service,@Controller)æ³¨è§£çš„ beanï¼Œæ³¨è§£é»˜è®¤ä¼šæ‰«æè¯¥ç±»æ‰€åœ¨çš„åŒ…ä¸‹æ‰€æœ‰çš„ç±»ã€‚ @Configurationï¼šå…è®¸åœ¨ Spring ä¸Šä¸‹æ–‡ä¸­æ³¨å†Œé¢å¤–çš„ bean æˆ–å¯¼å…¥å…¶ä»–é…ç½®ç±» Autowired #è‡ªåŠ¨å¯¼å…¥å¯¹è±¡åˆ°ç±»ä¸­ï¼Œè¢«æ³¨å…¥è¿›çš„ç±»åŒæ ·è¦è¢« Spring å®¹å™¨ç®¡ç†æ¯”å¦‚ï¼šService ç±»æ³¨å…¥åˆ° Controller ç±»ä¸­ã€‚\n@Service public class UserService { ...... } @RestController @RequestMapping(\u0026#34;/users\u0026#34;) public class UserController { @Autowired private UserService userService; ...... } Component Service Controller Repository #æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ @Autowired æ³¨è§£è®© Spring å®¹å™¨å¸®æˆ‘ä»¬è‡ªåŠ¨è£…é… beanã€‚è¦æƒ³æŠŠç±»æ ‡è¯†æˆå¯ç”¨äº @Autowired æ³¨è§£è‡ªåŠ¨è£…é…çš„ bean çš„ç±»,å¯ä»¥é‡‡ç”¨ä»¥ä¸‹æ³¨è§£å®ç°ï¼š\n@Componentï¼šé€šç”¨çš„æ³¨è§£ï¼Œå¯æ ‡æ³¨ä»»æ„ç±»ä¸º Spring ç»„ä»¶ã€‚å¦‚æœä¸€ä¸ª Bean ä¸çŸ¥é“å±äºå“ªä¸ªå±‚ï¼Œå¯ä»¥ä½¿ç”¨@Component æ³¨è§£æ ‡æ³¨ã€‚ @Repository : å¯¹åº”æŒä¹…å±‚å³ Dao å±‚ï¼Œä¸»è¦ç”¨äºæ•°æ®åº“ç›¸å…³æ“ä½œã€‚ @Service : å¯¹åº”æœåŠ¡å±‚ï¼Œä¸»è¦æ¶‰åŠä¸€äº›å¤æ‚çš„é€»è¾‘ï¼Œéœ€è¦ç”¨åˆ° Dao å±‚ã€‚ @Controller : å¯¹åº” Spring MVC æ§åˆ¶å±‚ï¼Œä¸»è¦ç”¨äºæ¥å—ç”¨æˆ·è¯·æ±‚å¹¶è°ƒç”¨ Service å±‚è¿”å›æ•°æ®ç»™å‰ç«¯é¡µé¢ã€‚ RestController #@RestControlleræ³¨è§£æ˜¯@Controllerå’Œ@ResponseBodyçš„åˆé›†,è¡¨ç¤ºè¿™æ˜¯ä¸ªæ§åˆ¶å™¨ bean,å¹¶ä¸”æ˜¯å°†å‡½æ•°çš„è¿”å›å€¼ç›´æ¥å¡«å…¥ HTTP å“åº”ä½“ä¸­,æ˜¯ REST é£æ ¼çš„æ§åˆ¶å™¨ã€‚\nScope #å£°æ˜ Spring Bean çš„ä½œç”¨åŸŸï¼Œä½¿ç”¨æ–¹æ³•:\n@Bean @Scope(\u0026#34;singleton\u0026#34;) public Person personSingleton() { return new Person(); } singleton : å”¯ä¸€ bean å®ä¾‹ï¼ŒSpring ä¸­çš„ bean é»˜è®¤éƒ½æ˜¯å•ä¾‹çš„ã€‚ prototype : æ¯æ¬¡è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ bean å®ä¾‹ã€‚ request : æ¯ä¸€æ¬¡ HTTP è¯·æ±‚éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ beanï¼Œè¯¥ bean ä»…åœ¨å½“å‰ HTTP request å†…æœ‰æ•ˆã€‚ session : æ¯ä¸€ä¸ª HTTP Session ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ beanï¼Œè¯¥ bean ä»…åœ¨å½“å‰ HTTP session å†…æœ‰æ•ˆã€‚ Configuration #ä¸€èˆ¬ç”¨æ¥å£°æ˜é…ç½®ç±»ï¼Œå¯ä»¥ä½¿ç”¨ @Componentæ³¨è§£æ›¿ä»£ï¼Œä¸è¿‡ä½¿ç”¨@Configurationæ³¨è§£å£°æ˜é…ç½®ç±»æ›´åŠ è¯­ä¹‰åŒ–ã€‚\n@Configuration public class AppConfig { @Bean public TransferService transferService() { return new TransferServiceImpl(); } } PathVariable #@PathVariableç”¨äºè·å–è·¯å¾„å‚æ•°ï¼Œ@RequestParamç”¨äºè·å–æŸ¥è¯¢å‚æ•°ã€‚\n@GetMapping(\u0026#34;/user/{id}/teachers\u0026#34;) public List\u0026lt;Teacher\u0026gt; getKlassRelatedTeachers( @PathVariable(\u0026#34;id\u0026#34;) Long id, @RequestParam(value = \u0026#34;type\u0026#34;, required = false) String type ) { ... } // è¯·æ±‚çš„ url æ˜¯ï¼š/user/123456/teachers?type=web // æœåŠ¡è·å–åˆ°çš„æ•°æ®å°±æ˜¯ï¼šid=123456,type=web Value #ä½¿ç”¨ @Value(\u0026quot;${property}\u0026quot;) è¯»å–æ¯”è¾ƒç®€å•çš„é…ç½®ä¿¡æ¯ï¼š\n@Value(\u0026#34;${wuhan2020}\u0026#34;) String wuhan2020; ConfigurationProperties #é€šè¿‡@ConfigurationPropertiesè¯»å–é…ç½®ä¿¡æ¯å¹¶ä¸ bean ç»‘å®šã€‚\n@Component @ConfigurationProperties(prefix = \u0026#34;library\u0026#34;) class LibraryProperties { @NotEmpty private String location; private List\u0026lt;Book\u0026gt; books; @Setter @Getter @ToString static class Book { String name; String description; } // çœç•¥getter/setter } Transactional #åœ¨è¦å¼€å¯äº‹åŠ¡çš„æ–¹æ³•ä¸Šä½¿ç”¨@Transactionalæ³¨è§£å³å¯!\n@Transactional(rollbackFor = Exception.class) public void save() { ...... } ä½œç”¨äºç±»ï¼šå½“æŠŠ@Transactional æ³¨è§£æ”¾åœ¨ç±»ä¸Šæ—¶ï¼Œè¡¨ç¤ºæ‰€æœ‰è¯¥ç±»çš„ public æ–¹æ³•éƒ½é…ç½®ç›¸åŒçš„äº‹åŠ¡å±æ€§ä¿¡æ¯ã€‚ ä½œç”¨äºæ–¹æ³•ï¼šå½“ç±»é…ç½®äº†@Transactionalï¼Œæ–¹æ³•ä¹Ÿé…ç½®äº†@Transactionalï¼Œæ–¹æ³•çš„äº‹åŠ¡ä¼šè¦†ç›–ç±»çš„äº‹åŠ¡é…ç½®ä¿¡æ¯ã€‚ äº‹åŠ¡çš„ç‰¹æ€§ï¼ˆACIDï¼‰ # åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼šäº‹åŠ¡æ˜¯æœ€å°çš„æ‰§è¡Œå•ä½ï¼Œä¸å…è®¸åˆ†å‰²ã€‚äº‹åŠ¡çš„åŸå­æ€§ç¡®ä¿åŠ¨ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå®Œå…¨ä¸èµ·ä½œç”¨ï¼› ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šæ‰§è¡Œäº‹åŠ¡å‰åï¼Œæ•°æ®ä¿æŒä¸€è‡´ï¼Œä¾‹å¦‚è½¬è´¦ä¸šåŠ¡ä¸­ï¼Œæ— è®ºäº‹åŠ¡æ˜¯å¦æˆåŠŸï¼Œè½¬è´¦è€…å’Œæ”¶æ¬¾äººçš„æ€»é¢åº”è¯¥æ˜¯ä¸å˜çš„ï¼› éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼šå¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œä¸€ä¸ªç”¨æˆ·çš„äº‹åŠ¡ä¸è¢«å…¶ä»–äº‹åŠ¡æ‰€å¹²æ‰°ï¼Œå„å¹¶å‘äº‹åŠ¡ä¹‹é—´æ•°æ®åº“æ˜¯ç‹¬ç«‹çš„ï¼› æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡è¢«æäº¤ä¹‹åã€‚å®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜æ˜¯æŒä¹…çš„ï¼Œå³ä½¿æ•°æ®åº“å‘ç”Ÿæ•…éšœä¹Ÿä¸åº”è¯¥å¯¹å…¶æœ‰ä»»ä½•å½±å“ã€‚ ","date":"14.11.2023","permalink":"/posts/java/java/basic/","section":"Posts","summary":"Spring bootæ³¨è§£åŸºæœ¬ç”¨æ³•","title":"basic"},{"content":"é›†åˆ(å®¹å™¨) #æ¥å£å’Œå®ç°åˆ†ç¦» # // é˜Ÿåˆ—æ¥å£ public interface Queue\u0026lt;E\u0026gt; { void add(E element); E remove(); int size(); } // public class CircularArrayQueue\u0026lt;E\u0026gt; implements Queue\u0026lt;E\u0026gt; { private int head; private int tail; CircularArrayQueue(int capacity) {} public void add(E element){} public E remove() {} public int size() {} private E[] elements; } public class LinkedListQueue\u0026lt;E\u0026gt; implements Queue\u0026lt;E\u0026gt; { private Link head; private Link tail; LinkedListQueue() {} public void add(E element) {} public E remove() {} public int size() {} } è¿­ä»£å™¨ # ä½¿ç”¨ next æ–¹æ³•é€ä¸ªè®¿é—®é›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ ã€‚ä½†æ˜¯ï¼Œå¦‚ä½•åˆ°è¾¾é›†åˆçš„æœ«å°¾ï¼Œnext æ–¹æ³•å°†æŠ›å‡ºä¸€ä¸ª NoSuchElementException\nCollection\u0026lt;String\u0026gt; c =...; Iterator\u0026lt;String\u0026gt; iter = c.iterator(); while(iter.hasNext()) { String element = iter.next(); // logic } // or for(String element : c){ // logic } // for é›†åˆ(å®¹å™¨)ã€‚åˆ†ä¸ºä¸¤ç±»: Collection å’Œ Map\npublic interface Collection\u0026lt;E\u0026gt; { boolean add(E element); Iterator\u0026lt;E\u0026gt; iterator(); } public interface Iterator\u0026lt;E\u0026gt; { E next(); boolean hasNext(); void remove(); default void forEachRemaining(Consumer\u0026lt;? super E\u0026gt; action); } public interface Iterable\u0026lt;E\u0026gt; { Iterator\u0026lt;E\u0026gt; iterator(); } Collection # Collection æ¥å£æ‰©å±•äº† Iterable æ¥å£\nSet\nadd æ–¹æ³•ä¸å…è®¸å¢åŠ é‡å¤çš„å…ƒç´ ã€‚equals æ–¹æ³•è®¤ä¸ºä¸¤ä¸ªé›†åˆåŒ…å«ç›¸åŒçš„å…ƒç´ å°±ç›¸ç­‰ï¼Œä¸è¦æ±‚é¡ºåºç›¸åŒã€‚\nHashSet: æ— ç»­ï¼Œå”¯ä¸€ã€‚åŸºäºHashMapå®ç°\nSet\u0026lt;String\u0026gt; words = new HashSet\u0026lt;\u0026gt;(Arrays.asList(\u0026#34;A\u0026#34;, \u0026#34;A\u0026#34;, \u0026#34;B\u0026#34;, \u0026#34;C\u0026#34;, \u0026#34;B\u0026#34;, \u0026#34;My\u0026#34;, \u0026#34;MY\u0026#34;, \u0026#34;My\u0026#34;)); words.add(\u0026#34;D\u0026#34;); for (String w : words) { System.out.println(w); } Iterator\u0026lt;String\u0026gt; iterator = words.iterator(); while (iterator.hasNext()) { System.out.println(iterator.next()); } TreeSet: æœ‰åºï¼Œå”¯ä¸€ã€‚çº¢é»‘æ ‘ï¼ˆè‡ªå¹³è¡¡çš„æ’åºäºŒå‰æ ‘ï¼‰\nSortedSet\u0026lt;String\u0026gt; sorter = new TreeSet\u0026lt;\u0026gt;(); sorter.add(\u0026#34;Bob\u0026#34;); sorter.add(\u0026#34;Amy\u0026#34;); sorter.add(\u0026#34;Carl\u0026#34;); for (String s : sorter) System.out.println(s); LinkedHashSet: LinkedHashSet æ˜¯ HashSet çš„å­ç±»ï¼Œå¹¶ä¸”å…¶å†…éƒ¨æ˜¯é€šè¿‡ LinkedHashMap æ¥å®ç°çš„ã€‚\nList\nåˆ†ä¸ºä¸¤ç§å®ç°ï¼Œæ•°ç»„å’Œé“¾è¡¨ã€‚æ•°ç»„æ”¯æŒéšæœºè®¿é—®ã€‚\nif (c instanceof RandomAccess){ // ä½¿ç”¨éšæœºè®¿é—®ç®—æ³• }else{ // çº¿æ€§è®¿é—® } ArrayList: Object[] æ•°ç»„\néåŒæ­¥ï¼Œçº¿ç¨‹ä¸å®‰å…¨ ç»§æ‰¿è‡ª AbstractListï¼Œå®ç°äº† List RandomAccess Cloneable java.io.Serializable æ¥å£ã€‚ public class ArrayList\u0026lt;E\u0026gt; extends AbstractList\u0026lt;E\u0026gt; implements List\u0026lt;E\u0026gt;, RandomAceess, Cloneable, java.io.Serializeable { private static final long serivalVersionUID = 8683452581122892189L; /** * é»˜è®¤åˆå§‹åŒ–å¤§å° */ private static final int DEFAULT_CAPACITY = 10; /** * ç©ºæ•°ç»„ */ private static final Object[] EMPTY_ELEMENTDATA = {}; //ç”¨äºé»˜è®¤å¤§å°ç©ºå®ä¾‹çš„å…±äº«ç©ºæ•°ç»„å®ä¾‹ã€‚ //æˆ‘ä»¬æŠŠå®ƒä»EMPTY_ELEMENTDATAæ•°ç»„ä¸­åŒºåˆ†å‡ºæ¥ï¼Œä»¥çŸ¥é“åœ¨æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ æ—¶å®¹é‡éœ€è¦å¢åŠ å¤šå°‘ã€‚ private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {}; } List\u0026lt;String\u0026gt; chars = new ArrayList\u0026lt;\u0026gt;(); // or List\u0026lt;String\u0026gt; names = new ArrayList\u0026lt;\u0026gt;(Arrays.asList(\u0026#34;A\u0026#34;, \u0026#34;B\u0026#34;, \u0026#34;C\u0026#34;)); chars.add(\u0026#34;A\u0026#34;); chars.add(\u0026#34;B\u0026#34;); chars.add(\u0026#34;C\u0026#34;); name.removeIf(c-\u0026gt;c.equals(\u0026#34;B\u0026#34;)); System.out.println(names.size()); // c æ˜¯ cllection names.addAll(c); // true names.contains(\u0026#34;A\u0026#34;); LinkedList: åŒå‘é“¾è¡¨\nåŒç«¯é˜Ÿåˆ—çš„é“¾è¡¨å®ç°ã€‚ ä¸æ”¯æŒéšæœºè®¿é—®ã€‚ List\u0026lt;String\u0026gt; staff = new LinkedList\u0026lt;\u0026gt;(); staff.add(\u0026#34;Amy\u0026#34;); staff.add(\u0026#34;Bob\u0026#34;); staff.add(\u0026#34;Carl\u0026#34;); // or List\u0026lt;String\u0026gt; staff = new LinkedList\u0026lt;\u0026gt;(Arrays.asList(\u0026#34;Amy\u0026#34;, \u0026#34;Bob\u0026#34;, \u0026#34;Carl\u0026#34;)); ListIterator\u0026lt;String\u0026gt; iter = staff.listIterator(); iter.next(); iter.add(\u0026#34;Juliet\u0026#34;); while (iter.hasNext()) { System.out.println(iter.next()); } Queue\nPriorityQueue: Object[] æ•°ç»„å®ç°çš„å°é¡¶å †\néçº¿ç¨‹å®‰å…¨ï¼Œä¸”ä¸æ”¯æŒå­˜å‚¨ NULL å’Œ non-comparable å¯¹è±¡ã€‚ å¯ä»¥æ¥æ”¶ä¸€ä¸ª Comparator ä½œä¸ºæ„é€ å‚æ•°è‡ªå®šä¹‰å…ƒç´ ä¼˜å…ˆçº§çš„å…ˆåã€‚ PriorityQueue\u0026lt;LocalDate\u0026gt; pq = new PriorityQueue\u0026lt;\u0026gt;(); DelayQueue: PriorityQueue\nArrayDeque: å¯æ‰©å®¹åŠ¨æ€åŒå‘æ•°ç»„ã€‚\nçº¿ç¨‹ä¸å®‰å…¨ã€‚ ä¸æ”¯æŒ null å€¼ã€‚ åŒç«¯é˜Ÿåˆ—çš„æ•°ç»„å®ç°ã€‚ ArrayDeque\u0026lt;Integer\u0026gt; deque = new ArrayDeque\u0026lt;\u0026gt;(Arrays.asList(2, 4, 6)); // è¿”å›å¹¶åˆ é™¤é˜Ÿé¦–å…ƒç´  // ä¸ºç©ºæŠ›å‡º NoSuchElementException deque.remove(); // ä¸ºç©ºè¿”å›null deque.poll(); // è¿”å›ä½†ä¸åˆ é™¤é˜Ÿé¦–å…ƒç´  // ä¸ºç©ºæŠ›å‡º NoSuchElementException deque.element(); // ä¸ºç©ºè¿”å›null deque.peek(); Map # HashMap: JDK1.8 ä¹‹å‰ HashMap ç”±æ•°ç»„+é“¾è¡¨ç»„æˆçš„ï¼Œæ•°ç»„æ˜¯ HashMap çš„ä¸»ä½“ï¼Œé“¾è¡¨åˆ™æ˜¯ä¸»è¦ä¸ºäº†è§£å†³å“ˆå¸Œå†²çªè€Œå­˜åœ¨çš„ï¼ˆâ€œæ‹‰é“¾æ³•â€è§£å†³å†²çªï¼‰ã€‚JDK1.8 ä»¥ååœ¨è§£å†³å“ˆå¸Œå†²çªæ—¶æœ‰äº†è¾ƒå¤§çš„å˜åŒ–ï¼Œå½“é“¾è¡¨é•¿åº¦å¤§äºé˜ˆå€¼ï¼ˆé»˜è®¤ä¸º 8ï¼‰ï¼ˆå°†é“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘å‰ä¼šåˆ¤æ–­ï¼Œå¦‚æœå½“å‰æ•°ç»„çš„é•¿åº¦å°äº 64ï¼Œé‚£ä¹ˆä¼šé€‰æ‹©å…ˆè¿›è¡Œæ•°ç»„æ‰©å®¹ï¼Œè€Œä¸æ˜¯è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼‰æ—¶ï¼Œå°†é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼Œä»¥å‡å°‘æœç´¢æ—¶é—´ã€‚\néçº¿ç¨‹å®‰å…¨ï¼Œ ConcurrentHashMap ä½¿ç”¨é”®ï¼ˆKeyï¼‰è®¡ç®— hashcode Map\u0026lt;String,String\u0026gt; user = new HashMap\u0026lt;\u0026gt;(); user.put(\u0026#34;\u0026lt;key\u0026gt;\u0026#34;,\u0026#34;value\u0026#34;); e = user.get(\u0026#34;\u0026lt;key\u0026gt;\u0026#34;); user.getOrDefault(\u0026#34;1\u0026#34;, \u0026#34;\u0026#34;); for (Map.Entry\u0026lt;String, String\u0026gt; entry : user.entrySet()) { String k = entry.getKey(); String v = entry.getValue(); System.out.println(\u0026#34;key: \u0026#34; + k + \u0026#34; value: \u0026#34; + v); } // or user.forEach((k, v) -\u0026gt; { System.out.println(\u0026#34;key: \u0026#34; + k + \u0026#34; value: \u0026#34; + v); }) LinkedHashMap: LinkedHashMap ç»§æ‰¿è‡ª HashMapï¼Œæ‰€ä»¥å®ƒçš„åº•å±‚ä»ç„¶æ˜¯åŸºäºæ‹‰é“¾å¼æ•£åˆ—ç»“æ„å³ç”±æ•°ç»„å’Œé“¾è¡¨æˆ–çº¢é»‘æ ‘ç»„æˆã€‚å¦å¤–ï¼ŒLinkedHashMap åœ¨ä¸Šé¢ç»“æ„çš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº†ä¸€æ¡åŒå‘é“¾è¡¨ï¼Œä½¿å¾—ä¸Šé¢çš„ç»“æ„å¯ä»¥ä¿æŒé”®å€¼å¯¹çš„æ’å…¥é¡ºåºã€‚åŒæ—¶é€šè¿‡å¯¹é“¾è¡¨è¿›è¡Œç›¸åº”çš„æ“ä½œï¼Œå®ç°äº†è®¿é—®é¡ºåºç›¸å…³é€»è¾‘ã€‚\n//! TODO\nHashtable: æ•°ç»„+é“¾è¡¨ç»„æˆçš„ï¼Œæ•°ç»„æ˜¯ Hashtable çš„ä¸»ä½“ï¼Œé“¾è¡¨åˆ™æ˜¯ä¸»è¦ä¸ºäº†è§£å†³å“ˆå¸Œå†²çªè€Œå­˜åœ¨çš„ã€‚\nTreeMap: çº¢é»‘æ ‘ï¼ˆè‡ªå¹³è¡¡çš„æ’åºäºŒå‰æ ‘ï¼‰ã€‚\n","date":"14.11.2023","permalink":"/posts/java/java/collection/","section":"Posts","summary":"Java é›†åˆ","title":"basic"},{"content":"","date":null,"permalink":"/tags/collection/","section":"Tags","summary":"","title":"Collection"},{"content":"ä»€ä¹ˆæ˜¯ SpringBoot è‡ªåŠ¨è£…é…ï¼Ÿ # SpringBoot å®šä¹‰äº†ä¸€å¥—æ¥å£è§„èŒƒï¼Œè¿™å¥—è§„èŒƒè§„å®šï¼šSpringBoot åœ¨å¯åŠ¨æ—¶ä¼šæ‰«æå¤–éƒ¨å¼•ç”¨ jar åŒ…ä¸­çš„ META-INF/spring.factories æ–‡ä»¶ï¼Œå°†æ–‡ä»¶ä¸­é…ç½®çš„ç±»å‹ä¿¡æ¯åŠ è½½åˆ° Spring å®¹å™¨ï¼ˆæ­¤å¤„æ¶‰åŠåˆ° JVM ç±»åŠ è½½æœºåˆ¶ä¸ Spring çš„å®¹å™¨çŸ¥è¯†ï¼‰ï¼Œå¹¶æ‰§è¡Œç±»ä¸­å®šä¹‰çš„å„ç§æ“ä½œã€‚å¯¹äºå¤–éƒ¨ jar æ¥è¯´ï¼Œåªéœ€è¦æŒ‰ç…§ SpringBoot å®šä¹‰çš„æ ‡å‡†ï¼Œå°±èƒ½å°†è‡ªå·±çš„åŠŸèƒ½è£…ç½®è¿› SpringBootã€‚\nè‡ªåŠ¨è£…é…å¯ä»¥ç®€å•ç†è§£ä¸ºï¼šé€šè¿‡æ³¨è§£æˆ–è€…ä¸€äº›ç®€å•çš„é…ç½®å°±èƒ½åœ¨ Spring Boot çš„å¸®åŠ©ä¸‹å®ç°æŸå—åŠŸèƒ½ã€‚\nSpringBoot æ˜¯å¦‚ä½•å®ç°è‡ªåŠ¨è£…é…çš„ï¼Ÿ #@Target({ElementType.TYPE}) @Retention(RetentionPolicy.RUNTIME) @Documented @Inherited \u0026lt;1.\u0026gt;@SpringBootConfiguration \u0026lt;2.\u0026gt;@ComponentScan \u0026lt;3.\u0026gt;@EnableAutoConfiguration public @interface SpringBootApplication { } @Target({ElementType.TYPE}) @Retention(RetentionPolicy.RUNTIME) @Documented @Configuration //å®é™…ä¸Šå®ƒä¹Ÿæ˜¯ä¸€ä¸ªé…ç½®ç±» public @interface SpringBootConfiguration { } å¤§æ¦‚å¯ä»¥æŠŠ @SpringBootApplicationçœ‹ä½œæ˜¯ @Configurationã€@EnableAutoConfigurationã€@ComponentScan æ³¨è§£çš„é›†åˆã€‚æ ¹æ® SpringBoot å®˜ç½‘ï¼Œè¿™ä¸‰ä¸ªæ³¨è§£çš„ä½œç”¨åˆ†åˆ«æ˜¯ï¼š\n@EnableAutoConfigurationï¼šå¯ç”¨ SpringBoot çš„è‡ªåŠ¨é…ç½®æœºåˆ¶ @Configurationï¼šå…è®¸åœ¨ä¸Šä¸‹æ–‡ä¸­æ³¨å†Œé¢å¤–çš„ bean æˆ–å¯¼å…¥å…¶ä»–é…ç½®ç±» @ComponentScanï¼šæ‰«æè¢«@Component (@Service,@Controller)æ³¨è§£çš„ beanï¼Œæ³¨è§£é»˜è®¤ä¼šæ‰«æå¯åŠ¨ç±»æ‰€åœ¨çš„åŒ…ä¸‹æ‰€æœ‰çš„ç±» ï¼Œå¯ä»¥è‡ªå®šä¹‰ä¸æ‰«ææŸäº› beanã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå®¹å™¨ä¸­å°†æ’é™¤TypeExcludeFilterå’ŒAutoConfigurationExcludeFilter @EnableAutoConfiguration:å®ç°è‡ªåŠ¨è£…é…çš„æ ¸å¿ƒæ³¨è§£ # EnableAutoConfiguration åªæ˜¯ä¸€ä¸ªç®€å•åœ°æ³¨è§£ï¼Œè‡ªåŠ¨è£…é…æ ¸å¿ƒåŠŸèƒ½çš„å®ç°å®é™…æ˜¯é€šè¿‡ AutoConfigurationImportSelectorç±»ã€‚\n@Target({ElementType.TYPE}) @Retention(RetentionPolicy.RUNTIME) @Documented @Inherited @AutoConfigurationPackage //ä½œç”¨ï¼šå°†mainåŒ…ä¸‹çš„æ‰€æœ‰ç»„ä»¶æ³¨å†Œåˆ°å®¹å™¨ä¸­ @Import({AutoConfigurationImportSelector.class}) //åŠ è½½è‡ªåŠ¨è£…é…ç±» xxxAutoconfiguration public @interface EnableAutoConfiguration { String ENABLED_OVERRIDE_PROPERTY = \u0026#34;spring.boot.enableautoconfiguration\u0026#34;; Class\u0026lt;?\u0026gt;[] exclude() default {}; String[] excludeName() default {}; } AutoConfigurationImportSelector:åŠ è½½è‡ªåŠ¨è£…é…ç±» #public class AutoConfigurationImportSelector implements DeferredImportSelector, BeanClassLoaderAware, ResourceLoaderAware, BeanFactoryAware, EnvironmentAware, Ordered { } public interface DeferredImportSelector extends ImportSelector { } public interface ImportSelector { String[] selectImports(AnnotationMetadata var1); } å¯ä»¥çœ‹å‡ºï¼ŒAutoConfigurationImportSelector ç±»å®ç°äº† ImportSelectoræ¥å£ï¼Œä¹Ÿå°±å®ç°äº†è¿™ä¸ªæ¥å£ä¸­çš„ selectImportsæ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸»è¦ç”¨äºè·å–æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„ç±»çš„å…¨é™å®šç±»åï¼Œè¿™äº›ç±»éœ€è¦è¢«åŠ è½½åˆ° IoC å®¹å™¨ä¸­ã€‚\nprivate static final String[] NO_IMPORTS = new String[0]; public String[] selectImports(AnnotationMetadata annotationMetadata) { // \u0026lt;1\u0026gt;.åˆ¤æ–­è‡ªåŠ¨è£…é…å¼€å…³æ˜¯å¦æ‰“å¼€ if (!this.isEnabled(annotationMetadata)) { return NO_IMPORTS; } else { //\u0026lt;2\u0026gt;.è·å–æ‰€æœ‰éœ€è¦è£…é…çš„bean AutoConfigurationMetadata autoConfigurationMetadata = AutoConfigurationMetadataLoader.loadMetadata(this.beanClassLoader); AutoConfigurationImportSelector.AutoConfigurationEntry autoConfigurationEntry = this.getAutoConfigurationEntry(autoConfigurationMetadata, annotationMetadata); return StringUtils.toStringArray(autoConfigurationEntry.getConfigurations()); } } private static final AutoConfigurationEntry EMPTY_ENTRY = new AutoConfigurationEntry(); AutoConfigurationEntry getAutoConfigurationEntry(AutoConfigurationMetadata autoConfigurationMetadata, AnnotationMetadata annotationMetadata) { //\u0026lt;1\u0026gt;. if (!this.isEnabled(annotationMetadata)) { return EMPTY_ENTRY; } else { //\u0026lt;2\u0026gt;. AnnotationAttributes attributes = this.getAttributes(annotationMetadata); //\u0026lt;3\u0026gt;. List\u0026lt;String\u0026gt; configurations = this.getCandidateConfigurations(annotationMetadata, attributes); //\u0026lt;4\u0026gt;. configurations = this.removeDuplicates(configurations); Set\u0026lt;String\u0026gt; exclusions = this.getExclusions(annotationMetadata, attributes); this.checkExcludedClasses(configurations, exclusions); configurations.removeAll(exclusions); configurations = this.filter(configurations, autoConfigurationMetadata); this.fireAutoConfigurationImportEvents(configurations, exclusions); return new AutoConfigurationImportSelector.AutoConfigurationEntry(configurations, exclusions); } } åˆ¤æ–­è‡ªåŠ¨è£…é…å¼€å…³æ˜¯å¦æ‰“å¼€ã€‚é»˜è®¤spring.boot.enableautoconfiguration=trueï¼Œå¯åœ¨ application.properties æˆ– application.yml ä¸­è®¾ç½® ç”¨äºè·å–EnableAutoConfigurationæ³¨è§£ä¸­çš„ exclude å’Œ excludeNameã€‚ è·å–éœ€è¦è‡ªåŠ¨è£…é…çš„æ‰€æœ‰é…ç½®ç±»ï¼Œè¯»å–META-INF/spring.factories å¦‚ä½•å®ç°ä¸€ä¸ª Starter # åˆ›å»ºå·¥ç¨‹ (-spring-boot-starter) å¼•å…¥ Spring Boot ç›¸å…³ä¾èµ– ï¼ˆ spring boot stater åŸºç¡€åº“ï¼‰ åˆ›å»º(PoolAutoConfiguration) @Configuration public class \u0026lt;Name\u0026gt;AutoConfiguration { @Bean @ConditiononClass(ThreadPoolExecutor.class) public ThreadPoolExecutor Classname(){ return new ThreadPoolExecutor() } } åœ¨ \u0026lt;name\u0026gt;-spring-boot-starterå·¥ç¨‹çš„ resources åŒ…ä¸‹åˆ›å»ºMETA-INF/spring.factoriesæ–‡ä»¶ ","date":"14.11.2023","permalink":"/posts/java/java/autoconfig/","section":"Posts","summary":"Spring boot è‡ªåŠ¨è½¬é…çš„æ¦‚å¿µå’ŒåŸç†","title":"SpringBoot è‡ªåŠ¨è£…é…åŸç†"},{"content":"","date":null,"permalink":"/tags/cgroup/","section":"Tags","summary":"","title":"cgroup"},{"content":"cgroup #mount #ç›®å‰æ”¯æŒçš„æŒ‚è½½æ–¹å¼ä¸ºï¼š\nnsdelegate favordynmods memory_localevents åªèƒ½æŒ‚è½½æ—¶è®¾ç½®æˆ–è€…é€šè¿‡ä» init å‘½åç©ºé—´é‡æ–°æŒ‚è½½æ¥ä¿®æ”¹ï¼Œè¿™æ˜¯ç³»ç»ŸèŒƒå›´çš„é€‰é¡¹ã€‚åªç”¨å½“å‰ cgroup çš„æ•°æ®å¡«å…… memory.eventsï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªé€‰é¡¹ï¼Œé»˜è®¤ä¼šè®¡æ•°æ‰€æœ‰å­æ ‘ï¼› memory_recursiveprot é€’å½’åœ°å°† memory.min å’Œ memory.low ä¿æŠ¤åº”ç”¨äºæ•´ä¸ªå­æ ‘ï¼Œæ— éœ€æ˜¾å¼å‘ä¸‹ä¼ æ’­åˆ°å¶èŠ‚ç‚¹çš„ cgroup ä¸­ï¼Œå­æ ‘å†…å¶å­èŠ‚ç‚¹å¯ä»¥è‡ªç”±ç«äº‰ ç»„ç»‡è¿›ç¨‹å’Œçº¿ç¨‹ #è¿›ç¨‹ #æ¯ä¸ª cgroup æœ‰ä¸€ä¸ªå¯è¯»å†™çš„çš„æ–‡ä»¶ cgroup.procs\nçº¿ç¨‹ #","date":"14.03.2023","permalink":"/posts/linux/linux/cgroup/","section":"Posts","summary":"for linux cgroup","title":"cgroup"},{"content":"","date":null,"permalink":"/tags/docker/","section":"Tags","summary":"","title":"docker"},{"content":"","date":null,"permalink":"/tags/linux/","section":"Tags","summary":"","title":"linux"},{"content":"","date":null,"permalink":"/tags/ubuntu/","section":"Tags","summary":"","title":"ubuntu"},{"content":"æ‹‰å–é•œåƒ #docker pull ubuntu åˆ›å»ºå®¹å™¨ #docker run -i -t --name ubuntu ubuntu bash Ubuntu åŸºæœ¬é…ç½® #apt-get update apt-get install vim æ›´æ–°è½¯ä»¶æº #/etc/apt/sources.list\ndeb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse apt-get update apt-get install git é…ç½® SSH #apt-get install openssh-server é…ç½® sshd #/etc/ssh/sshd_config\nPermitRootLogin yes # å¯ä»¥ç™»å½• root ç”¨æˆ· PubkeyAuthentication yes # å¯ä»¥ä½¿ç”¨ ssh å…¬é’¥è®¸å¯ AuthorizedKeysFile\t.ssh/authorized_keys # å…¬é’¥ä¿¡æ¯ä¿å­˜åˆ°æ–‡ä»¶ .ssh/authorized_keys ä¸­ é‡å¯ sshd #/etc/init.d/ssh restart ä¸»æœº SSH å…¬é’¥ # åœ¨ HOME ç›®å½•ä¸‹åˆ›å»º .ssh ç›®å½•ï¼šmkdir ~/.ssh æ–°å»ºæ–‡ä»¶ ~/.ssh/authorized_keys ï¼štouch ~/.ssh/authorized_keys æ–°å¼€ä¸€ä¸ª macOS ä¸‹çš„ç»ˆç«¯çª—å£ï¼Œæ‰§è¡Œå‘½ä»¤ cat ~/.ssh/id_rsa.pubï¼Œå¤åˆ¶æ‰“å°çš„ä¸€è¡Œå…¬é’¥ä¿¡æ¯ å›åˆ° ubuntu å®¹å™¨ä¸­ï¼Œå°†ç¬¬ 3 æ­¥å¤åˆ¶çš„å…¬é’¥ç²˜è´´åˆ° ~/.ssh/authorized_keys ä¸­ä¿å­˜ã€‚ æäº¤ä¿®æ”¹åˆ°é•œåƒ #docker commit -m \u0026lt;Comment\u0026gt; -a \u0026lt;Author\u0026gt; \u0026lt;containerId\u0026gt; \u0026lt;ImageName\u0026gt; ","date":"14.03.2023","permalink":"/posts/linux/linux/ubuntu/","section":"Posts","summary":"ubuntu in docker","title":"Ubuntu in docker"},{"content":"","date":null,"permalink":"/tags/kubernetes/","section":"Tags","summary":"","title":"kubernetes"},{"content":"è°ƒåº¦å™¨é…ç½® #ä½ å¯ä»¥é€šè¿‡ç¼–å†™é…ç½®æ–‡ä»¶ï¼Œå¹¶å°†å…¶è·¯å¾„ä¼ ç»™ kube-scheduler çš„å‘½ä»¤è¡Œå‚æ•°ï¼Œå®šåˆ¶ kube-scheduler çš„è¡Œä¸ºã€‚\nè°ƒåº¦æ¨¡æ¿ï¼ˆProfileï¼‰å…è®¸ä½ é…ç½® kube-scheduler ä¸­çš„ä¸åŒè°ƒåº¦é˜¶æ®µã€‚æ¯ä¸ªé˜¶æ®µéƒ½æš´éœ²äºæŸä¸ªæ‰©å±•ç‚¹ä¸­ã€‚æ’ä»¶é€šè¿‡å®ç°ä¸€ä¸ªæˆ–å¤šä¸ªæ‰©å±•ç‚¹æ¥æä¾›è°ƒåº¦è¡Œä¸ºã€‚\nä½ å¯ä»¥é€šè¿‡è¿è¡Œ kube-scheduler \u0026ndash;config æ¥è®¾ç½®è°ƒåº¦æ¨¡æ¿ï¼Œ ä½¿ç”¨ KubeSchedulerConfigurationï¼ˆv1beta3 æˆ– v1ï¼‰ç»“æ„ä½“ã€‚\napiVersion: kubescheduler.config.k8s.io/v1 kind: KubeSchedulerConfiguration clientConnection: kubeconfig: /etc/srv/kubernetes/kube-scheduler/kubeconfig è¯´æ˜ï¼š é…ç½®æ–‡ä»¶ #è°ƒåº¦è¡Œä¸ºå‘ç”Ÿåœ¨ä¸€ç³»åˆ—é˜¶æ®µä¸­ï¼Œè¿™äº›é˜¶æ®µæ˜¯é€šè¿‡ä»¥ä¸‹æ‰©å±•ç‚¹å…¬å¼€çš„ï¼š\næ‰©å±•ç‚¹ # queueSortï¼šè¿™äº›æ’ä»¶å¯¹è°ƒåº¦é˜Ÿåˆ—ä¸­çš„æ‚¬å†³çš„ Pod æ’åºã€‚ ä¸€æ¬¡åªèƒ½å¯ç”¨ä¸€ä¸ªé˜Ÿåˆ—æ’åºæ’ä»¶ã€‚ preFilterï¼šè¿™äº›æ’ä»¶ç”¨äºåœ¨è¿‡æ»¤ä¹‹å‰é¢„å¤„ç†æˆ–æ£€æŸ¥ Pod æˆ–é›†ç¾¤çš„ä¿¡æ¯ã€‚ å®ƒä»¬å¯ä»¥å°† Pod æ ‡è®°ä¸ºä¸å¯è°ƒåº¦ã€‚ filterï¼šè¿™äº›æ’ä»¶ç›¸å½“äºè°ƒåº¦ç­–ç•¥ä¸­çš„æ–­è¨€ï¼ˆPredicatesï¼‰ï¼Œç”¨äºè¿‡æ»¤ä¸èƒ½è¿è¡Œ Pod çš„èŠ‚ç‚¹ã€‚ è¿‡æ»¤å™¨çš„è°ƒç”¨é¡ºåºæ˜¯å¯é…ç½®çš„ã€‚ å¦‚æœæ²¡æœ‰ä¸€ä¸ªèŠ‚ç‚¹é€šè¿‡æ‰€æœ‰è¿‡æ»¤å™¨çš„ç­›é€‰ï¼ŒPod å°†ä¼šè¢«æ ‡è®°ä¸ºä¸å¯è°ƒåº¦ã€‚ postFilterï¼šå½“æ— æ³•ä¸º Pod æ‰¾åˆ°å¯ç”¨èŠ‚ç‚¹æ—¶ï¼ŒæŒ‰ç…§è¿™äº›æ’ä»¶çš„é…ç½®é¡ºåºè°ƒç”¨ä»–ä»¬ã€‚ å¦‚æœä»»ä½• postFilter æ’ä»¶å°† Pod æ ‡è®°ä¸ºå¯è°ƒåº¦ï¼Œåˆ™ä¸ä¼šè°ƒç”¨å…¶ä½™æ’ä»¶ã€‚ preScoreï¼šè¿™æ˜¯ä¸€ä¸ªä¿¡æ¯æ‰©å±•ç‚¹ï¼Œå¯ç”¨äºé¢„æ‰“åˆ†å·¥ä½œã€‚ scoreï¼šè¿™äº›æ’ä»¶ç»™é€šè¿‡ç­›é€‰é˜¶æ®µçš„èŠ‚ç‚¹æ‰“åˆ†ã€‚è°ƒåº¦å™¨ä¼šé€‰æ‹©å¾—åˆ†æœ€é«˜çš„èŠ‚ç‚¹ã€‚ reserveï¼šè¿™æ˜¯ä¸€ä¸ªä¿¡æ¯æ‰©å±•ç‚¹ï¼Œå½“èµ„æºå·²ç»é¢„ç•™ç»™ Pod æ—¶ï¼Œä¼šé€šçŸ¥æ’ä»¶ã€‚ è¿™äº›æ’ä»¶è¿˜å®ç°äº† Unreserve æ¥å£ï¼Œåœ¨ Reserve æœŸé—´æˆ–ä¹‹åå‡ºç°æ•…éšœæ—¶è°ƒç”¨ã€‚ permitï¼šè¿™äº›æ’ä»¶å¯ä»¥é˜»æ­¢æˆ–å»¶è¿Ÿ Pod ç»‘å®šã€‚ preBindï¼šè¿™äº›æ’ä»¶åœ¨ Pod ç»‘å®šèŠ‚ç‚¹ä¹‹å‰æ‰§è¡Œã€‚ bindï¼šè¿™ä¸ªæ’ä»¶å°† Pod ä¸èŠ‚ç‚¹ç»‘å®šã€‚bind æ’ä»¶æ˜¯æŒ‰é¡ºåºè°ƒç”¨çš„ï¼Œåªè¦æœ‰ä¸€ä¸ªæ’ä»¶å®Œæˆäº†ç»‘å®šï¼Œå…¶ä½™æ’ä»¶éƒ½ä¼šè·³è¿‡ã€‚bind æ’ä»¶è‡³å°‘éœ€è¦ä¸€ä¸ªã€‚ postBindï¼šè¿™æ˜¯ä¸€ä¸ªä¿¡æ¯æ‰©å±•ç‚¹ï¼Œåœ¨ Pod ç»‘å®šäº†èŠ‚ç‚¹ä¹‹åè°ƒç”¨ã€‚ multiPointï¼šè¿™æ˜¯ä¸€ä¸ªä»…é…ç½®å­—æ®µï¼Œå…è®¸åŒæ—¶ä¸ºæ‰€æœ‰é€‚ç”¨çš„æ‰©å±•ç‚¹å¯ç”¨æˆ–ç¦ç”¨æ’ä»¶ è°ƒåº¦ç­–ç•¥ #è°ƒåº¦å™¨é€šè¿‡ Kubernetes çš„ç›‘æµ‹ï¼ˆWatchï¼‰æœºåˆ¶æ¥å‘ç°é›†ç¾¤ä¸­æ–°åˆ›å»ºä¸”å°šæœªè¢«è°ƒåº¦åˆ°èŠ‚ç‚¹ä¸Šçš„ Podã€‚ è°ƒåº¦å™¨ä¼šå°†æ‰€å‘ç°çš„æ¯ä¸€ä¸ªæœªè°ƒåº¦çš„ Pod è°ƒåº¦åˆ°ä¸€ä¸ªåˆé€‚çš„èŠ‚ç‚¹ä¸Šæ¥è¿è¡Œã€‚ è°ƒåº¦å™¨ä¼šä¾æ®ä¸‹æ–‡çš„è°ƒåº¦åŸåˆ™æ¥åšå‡ºè°ƒåº¦é€‰æ‹©ã€‚\nè°ƒåº¦æµç¨‹ # è¿‡æ»¤ æ‰“åˆ† ","date":"24.02.2023","permalink":"/posts/kubernetes/kubernetes/scheduler/","section":"Posts","summary":"kubernetes scheduler","title":"kubernetes scheduler"},{"content":"","date":null,"permalink":"/tags/scheduler/","section":"Tags","summary":"","title":"scheduler"},{"content":"","date":null,"permalink":"/tags/go/","section":"Tags","summary":"","title":"go"},{"content":"basic # åˆå§‹åŒ– åˆ›å»ºå®¹å™¨ id ä¸‹è½½ image åˆ›å»ºå®¹å™¨å·¥ä½œç›®å½• æŒ‚è½½æ–‡ä»¶ overlay æ–¹å¼ åˆ›å»º veth pair åˆ›å»º netns æŒ‚è½½ veth æ”¯æŒçš„å‘½ä»¤ # run child-mode setup-netns setup-veth ps exec images rmi container (overlay fs) #å®¹å™¨çš„å·¥ä½œç›®å½•\n/var/run/container/containers/containerId/fs /var/run/container/containers/containerId/fs/mnt /var/run/container/containers/containerId/fs/upperdir /var/run/container/containers/containerId/fs/workdir mount overlay file system #unix.mount() veth-pair #è™šæ‹Ÿç½‘ç»œè®¾å¤‡å¯¹,ç”¨äºè§£å†³ä¸åŒç½‘ç»œå‘½åç©ºé—´ä¹‹é—´çš„é€šä¿¡\nfunc setupVirtualEthOnHost(containerID string) error { veth0 := \u0026#34;veth0_\u0026#34; + containerID[:6] veth1 := \u0026#34;veth1_\u0026#34; + containerID[:6] linkAttrs := netlink.NewLinkAttrs() linkAttrs.Name = veth0 veth0Struct := \u0026amp;netlink.Veth{ LinkAttrs: linkAttrs, PeerName: veth1, PeerHardwareAddr: createMACAddress(), } if err := netlink.LinkAdd(veth0Struct); err != nil { return err } netlink.LinkSetUp(veth0Struct) containerBridge, _ := netlink.LinkByName(\u0026#34;container0\u0026#34;) netlink.LinkSetMaster(veth0Struct, containerBridge) return nil } ","date":"29.10.2022","permalink":"/posts/docker/docker/create/","section":"Posts","summary":"é€šè¿‡ä½¿ç”¨ go å®ç°ä¸€ä¸ªå¯ç”¨çš„ docker æ¥äº†è§£ docker çš„å·¥ä½œåŸç†ã€‚","title":"ä»é›¶å¼€å§‹å®ç°ä¸€ä¸ªå¯ç”¨çš„ docker"},{"content":"å…³é—­é˜²ç«å¢™ #systemctl disable firewalld systemctl stop firewalld å…³é—­ selinux #setenforce 0 sed -i \u0026#39;s/SELINUX=permissive/SELINUX=disabled/\u0026#39; /etc/sysconfig/selinux sed -i \u0026#34;s/SELINUX=enforcing/SELINUX=disabled/g\u0026#34; /etc/selinux/config å…³é—­ swap #swapoff -a sed -i \u0026#39;s/.*swap.*/#\u0026amp;/\u0026#39; /etc/fstab æ·»åŠ ä¸»æœºåä¸ IP å¯¹åº”çš„å…³ç³» #hostnamectl set-hostname k8s-master vim /etc/hosts #æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š 10.0.24.13 k8s-master å°†æ¡¥æ¥çš„ IPV4 æµé‡ä¼ é€’åˆ° iptables çš„é“¾ #cat \u0026gt; /etc/sysctl.d/k8s.conf \u0026lt;\u0026lt; EOF net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1 EOF sysctl --system yum #**rm -rfv /etc/yum.repos.d/* curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-8.repo yum install -y yum-utils yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo # é…ç½®k8sé˜¿é‡Œäº‘æº cat \u0026lt;\u0026lt;EOF \u0026gt; /etc/yum.repos.d/kubernetes.repo [kubernetes] name=Kubernetes baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/ enabled=1 gpgcheck=1 repo_gpgcheck=1 gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg EOF** åŸºç¡€åŒ… #yum install vim bash-completion net-tools gcc -y docker #yum install docker-ce systemctl start docker # å¯åŠ¨Docker systemctl enable docker # è®¾ç½®è‡ªåŠ¨å¯åŠ¨ docker config #/etc/docker/daemon.json { \u0026#34;registry-mirrors\u0026#34;: [ \u0026#34;https://56tyyl4k.mirror.aliyuncs.com\u0026#34; ], \u0026#34;exec-opts\u0026#34;: [\u0026#34;native.cgroupdriver=systemd\u0026#34;] } systemctl daemon-reload systemctl restart docker kubernetes ç»„ä»¶ #yum install -y kubectl kubeadm kubelet systemctl enable kubelet \u0026amp;\u0026amp; systemctl start kubelet åˆå§‹åŒ– #kubeadm init --image-repository registry.aliyuncs.com/google_containers --kubernetes-version v1.23.1 --pod-network-cidr=10.0.24.13/16 kubectl apply -f https://docs.projectcalico.org/manifests/calico.yaml kubectl config #mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config source \u0026lt;(kubectl completion bash) æ±¡ç‚¹ #kubectl taint nodes k8s-master node-role.kubernetes.io/master:NoSchedule- ","date":"26.10.2022","permalink":"/posts/kubernetes/kubernetes/mount/","section":"Posts","summary":"ä½¿ç”¨ kubeadm åœ¨ liunx ä¸Šå®‰è£… kubernetes","title":"kubernetes éƒ¨ç½²"},{"content":"éƒ¨ç½² nfs server # å®‰è£…è½¯ä»¶åŒ… yum install -y rpcbind nfs-utils ä¿®æ”¹ /etc/exports /hone/nfs/ \\*(insecure,rw,sync,no_root_squash) å¯åŠ¨ nfs æœåŠ¡ mkdir /home/nfs systemctl enable rpcbind systemctl enable nfs-server systemctl start rpcbind systemctl start nfs-server exportfs -r exportfs åˆ›å»º RABC #ç”¨æˆ·åˆ›å»º nfs client #apiVersion: v1 kind: ServiceAccount metadata: name: nfs-client-provisioner namespace: default --- kind: ClusterRole apiVersion: rbac.authorization.k8s.io/v1 metadata: name: nfs-client-provisioner-runner rules: - apiGroups: [\u0026#39;\u0026#39;] resources: [\u0026#39;persistentvolumes\u0026#39;] verbs: [\u0026#39;get\u0026#39;, \u0026#39;list\u0026#39;, \u0026#39;watch\u0026#39;, \u0026#39;create\u0026#39;, \u0026#39;delete\u0026#39;] - apiGroups: [\u0026#39;\u0026#39;] resources: [\u0026#39;persistentvolumeclaims\u0026#39;] verbs: [\u0026#39;get\u0026#39;, \u0026#39;list\u0026#39;, \u0026#39;watch\u0026#39;, \u0026#39;update\u0026#39;] - apiGroups: [\u0026#39;storage.k8s.io\u0026#39;] resources: [\u0026#39;storageclasses\u0026#39;] verbs: [\u0026#39;get\u0026#39;, \u0026#39;list\u0026#39;, \u0026#39;watch\u0026#39;] - apiGroups: [\u0026#39;\u0026#39;] resources: [\u0026#39;events\u0026#39;] verbs: [\u0026#39;create\u0026#39;, \u0026#39;update\u0026#39;, \u0026#39;patch\u0026#39;] --- kind: ClusterRoleBinding apiVersion: rbac.authorization.k8s.io/v1 metadata: name: run-nfs-client-provisioner subjects: - kind: ServiceAccount name: nfs-client-provisioner namespace: default roleRef: kind: ClusterRole name: nfs-client-provisioner-runner apiGroup: rbac.authorization.k8s.io --- kind: Role apiVersion: rbac.authorization.k8s.io/v1 metadata: name: leader-locking-nfs-client-provisioner namespace: default rules: - apiGroups: [\u0026#39;\u0026#39;] resources: [\u0026#39;endpoints\u0026#39;] verbs: [\u0026#39;get\u0026#39;, \u0026#39;list\u0026#39;, \u0026#39;watch\u0026#39;, \u0026#39;create\u0026#39;, \u0026#39;update\u0026#39;, \u0026#39;patch\u0026#39;] --- kind: RoleBinding apiVersion: rbac.authorization.k8s.io/v1 metadata: name: leader-locking-nfs-client-provisioner namespace: default subjects: - kind: ServiceAccount name: nfs-client-provisioner namespace: default roleRef: kind: Role name: leader-locking-nfs-client-provisioner apiGroup: rbac.authorization.k8s.io éƒ¨ç½² nfs client #ç”¨äºè‡ªåŠ¨åˆ›å»º pvc #apiVersion: apps/v1 kind: Deployment metadata: name: nfs-client-provisioner labels: app: nfs-client-provisioner namespace: default spec: replicas: 1 strategy: type: Recreate selector: matchLabels: app: nfs-client-provisioner template: metadata: labels: app: nfs-client-provisioner spec: serviceAccountName: nfs-client-provisioner containers: - name: nfs-client-provisioner image: registry.cn-hangzhou.aliyuncs.com/jimywu/nfs-subdir-external-provisioner:v4.0.0 volumeMounts: - name: nfs-client-root mountPath: /persistentvolumes env: - name: PROVISIONER_NAME value: k8s-sigs.io/nfs-subdir-external-provisioner - name: NFS_SERVER value: 10.0.24.13 - name: NFS_PATH value: /home/nfs volumes: - name: nfs-client-root nfs: server: 10.0.24.13 path: /home/nfs åˆ›å»º StorageClass #ç”¨äº mysql è‡ªåŠ¨æ‰©å®¹æˆ–è€…æ‰€å®¹ç»‘å®š pvc #apiVersion: storage.k8s.io/v1 kind: StorageClass metadata: name: mysql-storage provisioner: k8s-sigs.io/nfs-subdir-external-provisioner reclaimPolicy: Retain volumeBindingMode: Immediate åˆ›å»º StatefulSet #apiVersion: apps/v1 kind: StatefulSet metadata: name: mysql-backend spec: selector: matchLabels: app: mysql # åŒ¹é… .spec.template.metadata.labels serviceName: mysql-svc-master replicas: 1 template: metadata: labels: app: mysql # åŒ¹é… .spec.selector.matchLabels spec: initContainers: - name: init-mysql image: mysql:8.0 command: - bash - \u0026#39;-c\u0026#39; - | set ex # Generate mysql server-id from pod ordinal index. [[ `hostname` =~ -([0-9]+)$ ]] || exit 1 ordinal=${BASH_REMATCH[1]} echo [mysqld] \u0026gt; /mnt/conf.d/server-id.cnf # Add an offset to avoid reserved server-id=0 value. echo server-id=$((100 + $ordinal)) \u0026gt;\u0026gt; /mnt/conf.d/server-id.cnf # Copy appropriate conf.d files from config-map to emptyDir. if [[ $ordinal -eq 0 ]]; then cp /mnt/config-map/master.cnf /mnt/conf.d/ else cp /mnt/config-map/slave.cnf /mnt/conf.d/ fi volumeMounts: - name: conf mountPath: /mnt/conf.d - name: config-map mountPath: /mnt/config-map - name: clone-mysql image: mzmuer/xtrabackup:1.0 command: - bash - \u0026#39;-c\u0026#39; - | set -ex # Skip the clone if data already exists. [[ -d /var/lib/mysql/mysql ]] \u0026amp;\u0026amp; exit 0 # Skip the clone on master (ordinal index 0). [[ `hostname` =~ -([0-9]+)$ ]] || exit 1 ordinal=${BASH_REMATCH[1]} [[ $ordinal -eq 0 ]] \u0026amp;\u0026amp; exit 0 # Clone data from previous peer. ncat --recv-only mysql-ss-$(($ordinal-1)).mysql-svc-master 13306 | xbstream -x -C /var/lib/mysql # Prepare the backup. xtrabackup --prepare --target-dir=/var/lib/mysql volumeMounts: - name: data mountPath: /var/lib/mysql subPath: mysql - name: conf mountPath: /etc/mysql/conf.d containers: - name: mysql image: mysql:8.0 args: [\u0026#39;--default-authentication-plugin=mysql_native_password\u0026#39;] env: - name: MYSQL_ROOT_PASSWORD value: \u0026#39;4rt5$RT%\u0026#39; ports: - name: mysql containerPort: 3306 volumeMounts: - name: data mountPath: /var/lib/mysql subPath: mysql - name: conf mountPath: /etc/mysql/conf.d resources: requests: cpu: 250m memory: 256Mi limits: cpu: 500m memory: 512Mi livenessProbe: exec: command: [\u0026#39;mysqladmin\u0026#39;, \u0026#39;-uroot\u0026#39;, \u0026#39;-p${MYSQL_ROOT_PASSWORD}\u0026#39;, \u0026#39;ping\u0026#39;] initialDelaySeconds: 30 periodSeconds: 10 timeoutSeconds: 5 readinessProbe: exec: # Check we can execute queries over TCP (skip-networking is off). command: [\u0026#39;mysqladmin\u0026#39;, \u0026#39;-uroot\u0026#39;, \u0026#39;-p${MYSQL_ROOT_PASSWORD}\u0026#39;, \u0026#39;ping\u0026#39;] initialDelaySeconds: 5 periodSeconds: 2 timeoutSeconds: 1 - name: xtrabackup image: mzmuer/xtrabackup:1.0 ports: - name: xtrabackup containerPort: 13306 command: - bash - \u0026#39;-c\u0026#39; - | set -ex cd /var/lib/mysql # Determine binlog position of cloned data, if any. if [[ -s xtrabackup_slave_info ]]; then # XtraBackup already generated a partial \u0026#34;CHANGE MASTER TO\u0026#34; query # because we\u0026#39;re cloning from an existing slave. mv xtrabackup_slave_info change_master_to.sql.in # Ignore xtrabackup_binlog_info in this case (it\u0026#39;s useless). rm -f xtrabackup_binlog_info elif [[ -f xtrabackup_binlog_info ]]; then # We\u0026#39;re cloning directly from master. Parse binlog position. [[ `cat xtrabackup_binlog_info` =~ ^(.*?)[[:space:]]+(.*?)$ ]] || exit 1 rm xtrabackup_binlog_info echo \u0026#34;CHANGE MASTER TO MASTER_LOG_FILE=\u0026#39;${BASH_REMATCH[1]}\u0026#39;,\\ MASTER_LOG_POS=${BASH_REMATCH[2]}\u0026#34; \u0026gt; change_master_to.sql.in fi # Check if we need to complete a clone by starting replication. if [[ -f change_master_to.sql.in ]]; then echo \u0026#34;Waiting for mysqld to be ready (accepting connections)\u0026#34; until mysql -h 127.0.0.1 -e \u0026#34;SELECT 1\u0026#34;; do sleep 1; done echo \u0026#34;Initializing replication from clone position\u0026#34; # In case of container restart, attempt this at-most-once. mv change_master_to.sql.in change_master_to.sql.orig mysql -h 127.0.0.1 \u0026lt;\u0026lt;EOF $(\u0026lt;change_master_to.sql.orig), MASTER_HOST=\u0026#39;mysql-ss-0.mysql-svc-master\u0026#39;, MASTER_USER=\u0026#39;root\u0026#39;, MASTER_PASSWORD=\u0026#39;\u0026#39;, MASTER_CONNECT_RETRY=10; START SLAVE; EOF fi # Start a server to send backups when requested by peers. exec ncat --listen --keep-open --send-only --max-conns=1 13306 -c \\ \u0026#34;xtrabackup --backup --slave-info --stream=xbstream --host=127.0.0.1 --user=root\u0026#34; volumeMounts: - name: data mountPath: /var/lib/mysql subPath: mysql - name: conf mountPath: /etc/mysql/conf.d resources: requests: cpu: 100m memory: 100Mi limits: cpu: 200m memory: 200Mi volumes: - name: conf emptyDir: {} - name: config-map configMap: name: mysql volumeClaimTemplates: - metadata: name: data spec: storageClassName: \u0026#39;mysql-storage\u0026#39; accessModes: [\u0026#39;ReadWriteOnce\u0026#39;] resources: requests: storage: 10Gi ","date":"24.10.2022","permalink":"/posts/kubernetes/kubernetes/mysql/","section":"Posts","summary":"kubernetes ä½¿ç”¨ stateful æ–¹å¼éƒ¨ç½² mysql","title":"stateful éƒ¨ç½² mysql"},{"content":"æ„å»ºé•œåƒ #docker build -t mysql:v8.0 æŸ¥çœ‹ pod çš„æ—¥å¿— #kubectl describe pod podname è¿›å…¥å®¹å™¨ #kubectl exec -it podname bash å¯åŠ¨å®¹å™¨ #docker run -dit --name emqx -p 18083:18083 -p 1883:1883 -p 8083:8083 -p 8084:8084 -v /etc/localtime:/etc/localtime --restart=always emqx/emqx:latest æŸ¥çœ‹ container ## è¿è¡Œçš„å®¹å™¨ docker ps # æ‰€æœ‰çš„å®¹å™¨ docker ps -a #format docker ps --format \u0026#34;table {{.ID}} {{.Image}} {{.Names}} {{.Ports}}\u0026#34; # åˆ é™¤åœæ­¢çš„å®¹å™¨ docker container prune ","date":"24.10.2022","permalink":"/posts/docker/docker/basic/","section":"Posts","summary":"docker åŸºæœ¬çš„çŸ¥è¯†","title":"docker basic"},{"content":"æŸ¥çœ‹å­è¿›ç¨‹ # pstree ç¬¬ä¸€ä¸ªè¿›ç¨‹æ˜¯ systemd è„šæœ¬æ–‡ä»¶å¯æ‰§è¡Œæƒé™ #chmod +x name.sh è¾“å‡º # echo \\t \\b æŸ¥çœ‹ç™»å½•è¿‡çš„ç”¨æˆ· #who who | wc -l å†™æ–‡ä»¶ ##è¦†ç›–å¼çš„ echo \u0026#34;content\u0026#34; \u0026gt; name.text cat name.text #è¿½åŠ å¼ echo \u0026#34;new content\u0026#34; \u0026gt;\u0026gt; name.text åˆ›å»ºæ–‡ä»¶ #touch a b c touch \u0026#34;a b c\u0026#34; rm -rf a b c å¤‡ä»½æ–‡ä»¶ #tar -czf /root/log-`date +%Y%m%d`.tar.gz /var/log/ ç§»åŠ¨æ–‡ä»¶å’Œä¿®æ”¹æ–‡ä»¶å #mv name mame mv name /name æ–‡æœ¬æ“ä½œ ## text è¦æœç´¢çš„æ–‡æœ¬ file ä¾›æœç´¢çš„æ–‡ä»¶ grep text file -r é€’å½’æŸ¥æ‰¾ -i å¿½ç•¥å¤§å°å†™ -v åªæ˜¾ç¤ºæœç´¢æ–‡æœ¬ä¸åœ¨çš„é‚£äº›è¡Œ -n æ˜¾ç¤ºè¡Œå· å¯¹æ–‡ä»¶çš„è¡Œè¿›è¡Œæ’åº #sort name.text -o æ’åºåå†™å…¥æ–°æ–‡ä»¶ -r å€’åºæ’åº -R éšæœºæ’åº -n å¯¹æ•°å­¦æ’åº wc #wc name.text -l åªç»Ÿè®¡è¡Œ -w åªç»Ÿè®¡å•è¯æ•° -c åªç»Ÿè®¡å­—èŠ‚æ•° -m åªç»Ÿè®¡å­—ç¬¦æ•° cut #cut -c 2-4 name.text è¾“å‡ºé‡å®šå‘ #cut -d, -f 1 note.csv \u0026gt; name.csv æŸ¥çœ‹è¿›ç¨‹ #w # å½“å‰ç³»ç»Ÿçš„è¿›ç¨‹ï¼Œç›¸å½“äºæ‰§è¡Œæ—¶çš„å¿«ç…§ ps # efÂ åˆ—å‡ºæ‰€æœ‰è¿›ç¨‹; efHÂ ä»¥ä¹”æœ¨çŠ¶åˆ—ä¸¾å‡ºæ‰€æœ‰è¿›ç¨‹; uÂ åˆ—å‡ºæ­¤ç”¨æˆ·è¿è¡Œçš„è¿›ç¨‹; auxÂ é€šè¿‡ CPUÂ å’Œå†…å­˜ä½¿ç”¨æ¥è¿‡æ»¤è¿›ç¨‹ ps -aux | lessÂ ; aux --sort -pcpuÂ æŒ‰ CPUÂ ä½¿ç”¨é™åºæ’åˆ—ï¼Œ aux --sort -pmemÂ è¡¨ç¤ºæŒ‰å†…å­˜ä½¿ç”¨é™åºæ’åˆ—; axjfÂ ä»¥æ ‘å½¢ç»“æ„æ˜¾ç¤ºè¿›ç¨‹ï¼Œ ps -axjfÂ å®ƒå’Œ pstreeÂ æ•ˆæœç±»ä¼¼ã€‚ top #è·å–è¿›ç¨‹çš„åŠ¨æ€åˆ—è¡¨\ntar #tar -cvf sort.tar sort/ tar -zcvf archive.tar.gz archive/ cvfÂ è¡¨ç¤º createï¼ˆåˆ›å»ºï¼‰+ verboseï¼ˆç»†èŠ‚ï¼‰+ fileï¼ˆæ–‡ä»¶ï¼‰ï¼Œåˆ›å»ºå½’æ¡£æ–‡ä»¶å¹¶æ˜¾ç¤ºæ“ä½œç»†èŠ‚ï¼› tfÂ æ˜¾ç¤ºå½’æ¡£é‡Œçš„å†…å®¹ï¼Œå¹¶ä¸è§£å¼€å½’æ¡£ï¼› rvfÂ è¿½åŠ æ–‡ä»¶åˆ°å½’æ¡£ï¼Œ tar -rvf archive.tar file.txtÂ ï¼› xvfÂ è§£å¼€å½’æ¡£ï¼Œ tar -xvf archive.tarÂ ã€‚ ","date":"23.10.2022","permalink":"/posts/linux/linux/command/","section":"Posts","summary":"for linux command","title":"command"},{"content":"Mutex #äº’æ–¥é”\näº’æ–¥é”çš„å®ç° #äº’æ–¥é”æ˜¯æ§åˆ¶å¹¶å‘çš„åŸºç¡€æ‰‹æ®µã€‚\npackage main import ( \u0026#34;fmt\u0026#34; \u0026#34;sync\u0026#34; ) func main() { var counter Counter var wg sync.WaitGroup wg.Add(10) for i := 0; i \u0026lt; 10; i++ { go func() { defer wg.Done() for j := 0; j \u0026lt; 10000; j++ { counter.Lock() counter.Count++ counter.Unlock() } }() } wg.Wait() fmt.Println(counter.Count) } type Counter struct { sync.Mutex Count uint64 } Pool #åˆ›å»ºæ± åŒ–çš„å¯¹è±¡\nsync.Pool #sync.Pool æ•°æ®ç±»å‹ç”¨æ¥ä¿å­˜ä¸€ç»„å¯ç‹¬ç«‹è®¿é—®çš„ä¸´æ—¶å¯¹è±¡ã€‚\nsync.Pool æœ¬èº«çº¿ç¨‹å®‰å…¨ï¼Œå¤šä¸ª goroutine å¯ä»¥å¹¶å‘åœ°è°ƒç”¨å®ƒçš„æ–¹æ³•å­˜å–å¯¹è±¡ã€‚ sync.Pool ä¸å¯åœ¨ä½¿ç”¨ä¹‹ååœ¨å¤åˆ¶ä½¿ç”¨ã€‚ sync.Pool çš„ä½¿ç”¨æ–¹æ³• #new #pool struct åŒ…å«ä¸€ä¸ª new å­—æ®µï¼Œè¿™ä¸ªå­—æ®µçš„ç±»å‹æ˜¯å‡½æ•° func() interface{}ã€‚å½“è°ƒç”¨ get æ–¹æ³•ä»æ± ä¸­è·å–å…ƒç´ çš„æ—¶å€™ï¼Œæ²¡æœ‰ç©ºé—²çš„å…ƒç´ å¯è¿”å›æ—¶ï¼Œä¾¿ä¼šè°ƒç”¨ new æ–°å»ºä¸€ä¸ªå…ƒç´ è¿”å›ã€‚\nget #è°ƒç”¨æ­¤æ–¹æ³•ä»æ± ä¸­å–èµ°ä¸€ä¸ªå…ƒç´ ã€‚\nput #æ­¤æ–¹æ³•å°†ä¸€ä¸ªå…ƒç´ è¿”è¿˜ç»™ poolï¼Œpool å°†è¿™ä¸ªå…ƒç´ ä¿å­˜åˆ°æ± ä¸­å¹¶ä¸”å¯ä»¥å¤ç”¨ã€‚\nbuffer ç¼“å†²æ±  #var buffers ={ New: func() interface{}{ return new(bytes.Buffer) }, } func GetBuffer() *bytes.Buffer{ return buffers.Get().(*bytes.Buffer) } func PutBuffer(buf *bytes.Buffer){ buf.Reset() buffers.Put(buf) } å®ç°åŸç† #Get æ–¹æ³• #func (p *Pool) Get() interface{} { // æŠŠå½“å‰ goroutine å›ºå®šåœ¨å½“å‰çš„pä¸Š l, pid := p.pin() x :=l.private //ä¼˜å…ˆä»local çš„ privateå­—æ®µå–ï¼Œå¿«é€Ÿ l.private = nil if x == nil { x,_ := l.shared.popHead() if x == nil{ x = p.getSlow(pid) } } runtime_procUnpin() // å¦‚æœæ²¡æœ‰è·å–åˆ°ï¼Œå°è¯•ä½¿ç”¨newå‡½æ•°ç”Ÿæˆä¸€ä¸ªæ–°çš„ if x = nil \u0026amp;\u0026amp; p.New != nil { x = p.New() } return x } å†…å­˜æ³„éœ² #ä½¿ç”¨ sync.Pool å›æ”¶ buffer çš„æ—¶å€™ï¼Œä¸€å®šè¦æ£€æŸ¥å›æ”¶çš„å¯¹è±¡çš„å¤§å°ã€‚\n","date":"23.10.2022","permalink":"/posts/go/go/sync/","section":"Posts","summary":"go stand library åŸºæœ¬çš„çŸ¥è¯†","title":"sync"},{"content":"","date":null,"permalink":"/tags/mysql/","section":"Tags","summary":"","title":"mysql"},{"content":"è¦†ç›–ç´¢å¼• # å°±æ˜¯ select çš„æ•°æ®åˆ—åªç”¨ä»ç´¢å¼•ä¸­å°±èƒ½å¤Ÿå–å¾—ï¼Œä¸å¿…è¯»å–æ•°æ®è¡Œï¼ŒMySQL å¯ä»¥åˆ©ç”¨ç´¢å¼•è¿”å› select åˆ—è¡¨ä¸­çš„å­—æ®µï¼Œè€Œä¸å¿…æ ¹æ®ç´¢å¼•å†æ¬¡è¯»å–æ•°æ®æ–‡ä»¶ï¼Œæ¢å¥è¯è¯´æŸ¥è¯¢åˆ—è¦è¢«æ‰€å»ºçš„ç´¢å¼•è¦†ç›–ã€‚ ç´¢å¼•æ˜¯é«˜æ•ˆæ‰¾åˆ°è¡Œçš„ä¸€ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯ä¸€èˆ¬æ•°æ®åº“ä¹Ÿèƒ½ä½¿ç”¨ç´¢å¼•æ‰¾åˆ°ä¸€ä¸ªåˆ—çš„æ•°æ®ï¼Œå› æ­¤å®ƒä¸å¿…è¯»å–æ•´ä¸ªè¡Œã€‚æ¯•ç«Ÿç´¢å¼•å¶å­èŠ‚ç‚¹å­˜å‚¨äº†å®ƒä»¬ç´¢å¼•çš„æ•°æ®ï¼Œå½“èƒ½é€šè¿‡è¯»å–ç´¢å¼•å°±å¯ä»¥å¾—åˆ°æƒ³è¦çš„æ•°æ®ï¼Œé‚£å°±ä¸éœ€è¦è¯»å–è¡Œäº†ã€‚ä¸€ä¸ªç´¢å¼•åŒ…å«ï¼ˆè¦†ç›–ï¼‰æ»¡è¶³æŸ¥è¯¢ç»“æœçš„æ•°æ®å°±å«åšè¦†ç›–ç´¢å¼•ã€‚ ä½¿ç”¨ explainï¼Œå¯ä»¥é€šè¿‡è¾“å‡ºçš„ extra åˆ—æ¥åˆ¤æ–­ï¼Œå¯¹äºä¸€ä¸ªç´¢å¼•è¦†ç›–æŸ¥è¯¢ï¼Œæ˜¾ç¤ºä¸ºusing indexï¼ŒMySQL æŸ¥è¯¢ä¼˜åŒ–å™¨åœ¨æ‰§è¡ŒæŸ¥è¯¢å‰ä¼šå†³å®šæ˜¯å¦æœ‰ç´¢å¼•è¦†ç›–æŸ¥è¯¢ æ€§èƒ½ä¼˜åŒ– # æ…¢æŸ¥è¯¢æ—¥å¿—ï¼ŒEXPLAIN åˆ†ææŸ¥è¯¢ï¼Œprofiling åˆ†æä»¥åŠshow å‘½ä»¤æŸ¥è¯¢ç³»ç»ŸçŠ¶æ€åŠç³»ç»Ÿå˜é‡ explain # è¡¨çš„è¯»å–é¡ºåº æ•°æ®è¯»å–æ“ä½œçš„æ“ä½œç±»å‹ å“ªäº›ç´¢å¼•å¯ä»¥ä½¿ç”¨ å“ªäº›ç´¢å¼•è¢«å®é™…ä½¿ç”¨ è¡¨ä¹‹é—´çš„å¼•ç”¨ æ¯å¼ è¡¨æœ‰å¤šå°‘è¡Œè¢«ä¼˜åŒ–å™¨æŸ¥è¯¢ ","date":"23.10.2022","permalink":"/posts/mysql/mysql/basic/","section":"Posts","summary":"mysql basic concept","title":"mysql basic"},{"content":" kubernetes åŸºæœ¬çš„çŸ¥è¯†\nPod #æŒ‡å®šç»ˆæ­¢å®½é™æœŸ #kubectl delete po podname --grace-period=5- token # kubectl -n kubernetes-dashboard get secret $(kubectl -n kubernetes-dashboard get sa/admin-user -o jsonpath=\u0026#34;{.secrets[0].name}\u0026#34;) -o go-template=\u0026#34;{{.data.token | base64decode}}\u0026#34; docker sercrets #kubectl create secret generic docker \\ --from-file=.dockerconfigjson=/root/.docker/config.json \\ --type=kubernetes.io/dockerconfigjson kubectl #å¤šé›†ç¾¤ä½¿ç”¨ kubectl #apiVersion: vl clusters: - cluster: certificate-authority: /home/sunweiwe/.minikube/ca.crt server: https://192.168.99.100:8443 name: minikube contexts: - context: cluster: minikube user: minikube namespace: default name: minikube current-context: minikube kind: Config preferences: {} users: - name: minikube user: client-certificate: /home/sunweiwe/ .minikube/apiserver.crt client-key: /home/sunweiwe/ .minikube/apiserver.key kubernetes æºç è°ƒè¯• #","date":"23.10.2022","permalink":"/posts/kubernetes/kubernetes/basic/","section":"Posts","summary":"\u003c!--abstract--\u003e\n\u003cp\u003ekubernetes åŸºæœ¬çš„çŸ¥è¯†\u003c/p\u003e","title":"kubernetes"},{"content":"","date":null,"permalink":"/tags/pprof/","section":"Tags","summary":"","title":"pprof"},{"content":"pprof æ˜¯ä»€ä¹ˆï¼Ÿ #pprof å·¥å…·å¯ä»¥ç”¨æ¥ç›‘æµ‹è¿›ç¨‹çš„è¿è¡Œæ•°æ®ï¼Œç”¨äºç›‘æ§ç¨‹åºçš„æ€§èƒ½ï¼Œå¯¹å†…å­˜ä½¿ç”¨å’Œ CPU ä½¿ç”¨çš„æƒ…å†µç»Ÿä¿¡æ¯è¿›è¡Œåˆ†æã€‚\né‡‡æ ·æ–¹å¼ # runtime/pprofï¼šé‡‡é›†ç¨‹åºï¼ˆé Serverï¼‰çš„æŒ‡å®šåŒºå—çš„è¿è¡Œæ•°æ®è¿›è¡Œåˆ†æã€‚ net/http/pprofï¼šåŸºäº HTTP Server è¿è¡Œï¼Œå¹¶ä¸”å¯ä»¥é‡‡é›†è¿è¡Œæ—¶æ•°æ®è¿›è¡Œåˆ†æã€‚ go testï¼šé€šè¿‡è¿è¡Œæµ‹è¯•ç”¨ä¾‹ï¼Œå¹¶æŒ‡å®šæ‰€éœ€æ ‡è¯†æ¥è¿›è¡Œé‡‡é›†ã€‚ ä½¿ç”¨æ¨¡å¼ # Report generationï¼šæŠ¥å‘Šç”Ÿæˆã€‚ Interactive terminal useï¼šäº¤äº’å¼ç»ˆç«¯ä½¿ç”¨ã€‚ (go tool pprof http://localhost:6060/debug/pprof/profile/(allocs|blocks|goroutine|etc..)) top list web Web interfaceï¼šWeb ç•Œé¢ã€‚ ä½¿ç”¨æ–¹å¼ #package main import ( // ç•¥ _ \u0026#34;net/http/pprof\u0026#34; // ä¼šè‡ªåŠ¨æ³¨å†Œ handler åˆ° http serverï¼Œæ–¹ä¾¿é€šè¿‡ http æ¥å£è·å–ç¨‹åºè¿è¡Œé‡‡æ ·æŠ¥å‘Š // ç•¥ ) func main() { // ç•¥ runtime.GOMAXPROCS(1) // é™åˆ¶ CPU ä½¿ç”¨æ•°ï¼Œé¿å…è¿‡è½½ runtime.SetMutexProfileFraction(1) // å¼€å¯å¯¹é”è°ƒç”¨çš„è·Ÿè¸ª runtime.SetBlockProfileRate(1) // å¼€å¯å¯¹é˜»å¡æ“ä½œçš„è·Ÿè¸ª go func() { // å¯åŠ¨ä¸€ä¸ª http serverï¼Œæ³¨æ„ pprof ç›¸å…³çš„ handler å·²ç»è‡ªåŠ¨æ³¨å†Œè¿‡äº† if err := http.ListenAndServe(\u0026#34;:6060\u0026#34;, nil); err != nil { log.Fatal(err) } os.Exit(0) }() } é‡‡é›†æ•°æ®ç±»å‹ # allocs å†…å­˜åˆ†é…æƒ…å†µçš„é‡‡æ ·ä¿¡æ¯ blocks é˜»å¡æ“ä½œæƒ…å†µçš„é‡‡æ ·ä¿¡æ¯ cmdline æ˜¾ç¤ºç¨‹åºå¯åŠ¨å‘½ä»¤åŠå‚æ•° goroutine å½“å‰æ‰€æœ‰åç¨‹çš„å †æ ˆä¿¡æ¯ heap å †ä¸Šå†…å­˜ä½¿ç”¨æƒ…å†µçš„é‡‡æ ·ä¿¡æ¯ mutex é”äº‰ç”¨æƒ…å†µçš„é‡‡æ ·ä¿¡æ¯ profile CPU å ç”¨æƒ…å†µçš„é‡‡æ ·ä¿¡æ¯ threadcreate ç³»ç»Ÿçº¿ç¨‹åˆ›å»ºæƒ…å†µçš„é‡‡æ ·ä¿¡æ¯ trace ç¨‹åºè¿è¡Œè·Ÿè¸ªä¿¡ ","date":"22.05.2022","permalink":"/posts/pprof/pprof/basic/","section":"Posts","summary":"pprof å·¥å…·å¯ä»¥ç”¨æ¥ç›‘æµ‹è¿›ç¨‹çš„è¿è¡Œæ•°æ®ï¼Œç”¨äºç›‘æ§ç¨‹åºçš„æ€§èƒ½ï¼Œå¯¹å†…å­˜ä½¿ç”¨å’Œ CPU ä½¿ç”¨çš„æƒ…å†µç»Ÿä¿¡æ¯è¿›è¡Œåˆ†æã€‚","title":"pprof"},{"content":"","date":"01.01.0001","permalink":"/-about/","section":"","summary":"","title":""},{"content":"","date":null,"permalink":"/topics/","section":"Topics","summary":"","title":"Topics"}]